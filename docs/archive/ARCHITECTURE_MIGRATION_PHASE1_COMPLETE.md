# ä¸œé£ç ´ - åŒæ¶æ„ç»Ÿä¸€è¿ç§» Phase 1 å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´**: 2025-10-01
**çŠ¶æ€**: âœ… Phase 1 å®Œæˆ - APIç½‘å…³å·²ä¸Šçº¿,æ–°æ—§ç³»ç»Ÿå…±å­˜
**ä¸‹ä¸€æ­¥**: Phase 2 - ä¸šåŠ¡é€»è¾‘è¿ç§»åˆ°æ–°å¾®æœåŠ¡

---

## ğŸ“Š è¿ç§»æˆæœæ€»ç»“

### âœ… å·²å®Œæˆå·¥ä½œ

#### 1. APIç½‘å…³å±‚å»ºç«‹ (Week 1-2 ç›®æ ‡)

**æœåŠ¡åœ°å€**: http://localhost:8080

**å®ç°åŠŸèƒ½**:
- âœ… ç»Ÿä¸€APIå…¥å£,ç®¡ç†Legacyå’Œæ–°å¾®æœåŠ¡è·¯ç”±
- âœ… è‡ªåŠ¨æœåŠ¡å‘ç°å’Œå¥åº·æ£€æŸ¥
- âœ… è¯·æ±‚è½¬å‘å’Œè´Ÿè½½å‡è¡¡
- âœ… Prometheusç›‘æ§æŒ‡æ ‡
- âœ… å®Œæ•´çš„CORSé…ç½®

**å…³é”®æ–‡ä»¶**:
- [services/api-gateway/main.py](services/api-gateway/main.py) - ç½‘å…³æ ¸å¿ƒå®ç°
- [scripts/start_gateway.sh](scripts/start_gateway.sh) - ç½‘å…³å¯åŠ¨è„šæœ¬

**æœåŠ¡çŠ¶æ€**:
```json
{
  "status": "degraded",
  "services": {
    "legacy": "âœ… healthy (9000)",
    "signal-api": "âœ… healthy (8000)",
    "backtest-service": "âœ… healthy (8200)",
    "signal-streamer": "âš ï¸ æœªå¯åŠ¨ (8002)",
    "strategy-engine": "âš ï¸ æœªå¯åŠ¨ (8003)"
  }
}
```

#### 2. å‰ç«¯é…ç½®æ›´æ–°

**é…ç½®æ–‡ä»¶**: [frontend/.env.development](frontend/.env.development)

**å˜æ›´å†…å®¹**:
```bash
# å¯ç”¨APIç½‘å…³æ¨¡å¼
REACT_APP_USE_API_GATEWAY=true

# ç½‘å…³ç»Ÿä¸€å…¥å£
REACT_APP_API_GATEWAY_URL=http://localhost:8080

# Legacyåç«¯(ä»…ä¾›ç›´è¿è°ƒè¯•)
REACT_APP_API_URL=http://localhost:9000
```

**å‰ç«¯æ”¯æŒ**: [frontend/src/config.ts](frontend/src/config.ts)
- âœ… å·²å®ç°ç½‘å…³/ç›´è¿åŒæ¨¡å¼åˆ‡æ¢
- âœ… ç¯å¢ƒå˜é‡åŠ¨æ€é…ç½®
- âœ… APIè·¯å¾„è‡ªåŠ¨æ˜ å°„

#### 3. è·¯ç”±æµ‹è¯•éªŒè¯

**Legacyè·¯ç”±æµ‹è¯•** (é€šè¿‡ç½‘å…³ â†’ 9000ç«¯å£):
```bash
âœ… GET /api/health                    # ç³»ç»Ÿå¥åº·æ£€æŸ¥
âœ… GET /api/stocks/000001/realtime    # å®æ—¶è¡Œæƒ…æ•°æ®
âœ… GET /api/anomaly/*                 # å¼‚åŠ¨æ£€æµ‹æ¥å£
âœ… GET /api/limit-up/*                # æ¶¨åœé¢„æµ‹æ¥å£
```

**æ–°æœåŠ¡è·¯ç”±æµ‹è¯•** (é€šè¿‡ç½‘å…³):
```bash
âœ… GET /opportunities                 # signal-apiæœºä¼šåˆ—è¡¨
âœ… GET /health (signal-api)          # æ–°æœåŠ¡å¥åº·æ£€æŸ¥
âœ… GET /health (backtest)            # å›æµ‹æœåŠ¡å¥åº·æ£€æŸ¥
```

---

## ğŸ—ï¸ å½“å‰æ¶æ„çŠ¶æ€

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ (3000) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ REACT_APP_USE_API_GATEWAY=true
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIç½‘å…³ (8080)â”‚ â­ æ–°å¢ç»Ÿä¸€å…¥å£
â”‚  - è·¯ç”±è½¬å‘     â”‚
â”‚  - å¥åº·æ£€æŸ¥     â”‚
â”‚  - ç›‘æ§æŒ‡æ ‡     â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚        â”‚
    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Legacy (9000)â”‚    â”‚ æ–°å¾®æœåŠ¡é›†ç¾¤     â”‚
â”‚ - 18ä¸ªè·¯ç”±    â”‚    â”‚ - signal-api    â”‚
â”‚ - FastAPI    â”‚    â”‚ - backtest      â”‚
â”‚ - å¼‚åŠ¨æ£€æµ‹    â”‚    â”‚ - (å¾…å¯åŠ¨...)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç«¯å£åˆ†é…

| ç«¯å£ | æœåŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| 3000 | Reactå‰ç«¯ | è¿è¡Œä¸­ | ç”¨æˆ·ç•Œé¢ |
| 8080 | **APIç½‘å…³** | âœ… è¿è¡Œä¸­ | **ç»Ÿä¸€å…¥å£** |
| 9000 | Legacyåç«¯ | âœ… è¿è¡Œä¸­ | 18ä¸ªAPIè·¯ç”± |
| 8000 | signal-api | âœ… è¿è¡Œä¸­ | æœºä¼šä¿¡å·æŸ¥è¯¢ |
| 8002 | signal-streamer | å¾…å¯åŠ¨ | WebSocketæ¨é€ |
| 8003 | strategy-engine | å¾…å¯åŠ¨ | ç­–ç•¥æ‰§è¡Œå¼•æ“ |
| 8200 | backtest-service | âœ… è¿è¡Œä¸­ | ç­–ç•¥å›æµ‹ |

---

## ğŸ¯ è¿ç§»è¿›åº¦è¯„ä¼°

### Phase 1 å®Œæˆåº¦: **75%**

| ä»»åŠ¡ | çŠ¶æ€ | è¿›åº¦ |
|------|------|------|
| APIç½‘å…³æ­å»º | âœ… å®Œæˆ | 100% |
| å‰ç«¯é…ç½®æ”¯æŒ | âœ… å®Œæˆ | 100% |
| Legacyè·¯ç”±æµ‹è¯• | âœ… å®Œæˆ | 100% |
| æ–°æœåŠ¡è·¯ç”±æµ‹è¯• | âœ… å®Œæˆ | 60% (2/5æœåŠ¡) |
| å‰ç«¯ç°åº¦åˆ‡æ¢ | ğŸ”„ å°±ç»ª | 0% (å¾…å‰ç«¯é‡å¯) |

### æœªå®Œæˆäº‹é¡¹

1. **WebSocketæœåŠ¡æœªå¯åŠ¨**
   - signal-streamer (8002ç«¯å£)
   - å½±å“: å®æ—¶æ¨é€åŠŸèƒ½æš‚ä¸å¯ç”¨

2. **ç­–ç•¥å¼•æ“æœªå¯åŠ¨**
   - strategy-engine (8003ç«¯å£)
   - å½±å“: æ–°ç­–ç•¥æ‰§è¡ŒåŠŸèƒ½ä¸å¯ç”¨

3. **å‰ç«¯æœªå®é™…åˆ‡æ¢**
   - å‰ç«¯æœåŠ¡éœ€è¦é‡å¯ä»¥åŠ è½½æ–°ç¯å¢ƒå˜é‡
   - å½“å‰ä»åœ¨ç›´è¿Legacy (9000)

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

### Phase 1 æ”¶å°¾ (é¢„è®¡1å‘¨)

#### 1. å¯åŠ¨å‰©ä½™å¾®æœåŠ¡
```bash
# å¯åŠ¨WebSocketæ¨é€æœåŠ¡
cd services/signal-streamer && python main.py

# å¯åŠ¨ç­–ç•¥å¼•æ“
cd services/strategy-engine && python main.py
```

#### 2. å‰ç«¯ç°åº¦åˆ‡æ¢
```bash
# é‡å¯å‰ç«¯æœåŠ¡,åŠ è½½ç½‘å…³é…ç½®
cd frontend
npm start
```

#### 3. ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æµ‹è¯•å‰ç«¯é€šè¿‡ç½‘å…³è®¿é—®Legacyæ¥å£
- [ ] æµ‹è¯•å‰ç«¯é€šè¿‡ç½‘å…³è®¿é—®æ–°æœåŠ¡
- [ ] éªŒè¯WebSocketè¿æ¥æ­£å¸¸
- [ ] æ€§èƒ½å¯¹æ¯”æµ‹è¯•(ç›´è¿ vs ç½‘å…³)

### Phase 2 è§„åˆ’ (2-4å‘¨)

#### 1. æ•°æ®å±‚è¿ç§»
**ç›®æ ‡**: å°†æ•°æ®è·å–é€»è¾‘è¿ç§»åˆ°collector-gateway

**æ­¥éª¤**:
1. å¯åŠ¨collector-gatewayæœåŠ¡
2. é…ç½®æ•°æ®æºæ’ä»¶(è…¾è®¯/ä¸œè´¢/æ–°æµª)
3. å°†Legacyçš„`core.data_sources.StockDataManager`åˆ‡æ¢åˆ°æ–°æœåŠ¡
4. éªŒè¯æ•°æ®ä¸€è‡´æ€§(>99%)

#### 2. ç¼“å­˜å±‚ç»Ÿä¸€
**ç›®æ ‡**: æ›¿æ¢Legacyæ–‡ä»¶ç¼“å­˜ä¸ºRedisç»Ÿä¸€ç¼“å­˜

**æ­¥éª¤**:
1. å¯åŠ¨RedisæœåŠ¡
2. è¿ç§»`core.cache_manager`åˆ°Redis
3. é…ç½®ç¼“å­˜ç­–ç•¥(TTLã€æ·˜æ±°ç®—æ³•)
4. éªŒè¯ç¼“å­˜å‘½ä¸­ç‡(>80%)

#### 3. ä¸šåŠ¡é€»è¾‘è¿ç§»
**ç›®æ ‡**: å°†å¼‚åŠ¨æ£€æµ‹ã€æ¶¨åœé¢„æµ‹è¿ç§»åˆ°strategy-engine

**è¿ç§»æ˜ å°„**:
| Legacyæ¨¡å— | æ–°æœåŠ¡ | ä¼˜å…ˆçº§ |
|-----------|--------|--------|
| `core.anomaly_detection` | strategy-engine | P0 |
| `api.limit_up_routes` | strategy-engine | P0 |
| `api.market_scanner` | opportunity-aggregator | P1 |
| `api.market_behavior_routes` | strategy-engine | P2 |

---

## ğŸ“ è¿ç»´æŒ‡å—

### å¿«é€Ÿå¯åŠ¨

**å®Œæ•´ç³»ç»Ÿå¯åŠ¨**:
```bash
# 1. å¯åŠ¨Legacyåç«¯
cd backend
PORT=9000 python main.py

# 2. å¯åŠ¨APIç½‘å…³
./scripts/start_gateway.sh

# 3. å¯åŠ¨æ–°å¾®æœåŠ¡
cd services/signal-api && python main.py &
cd services/backtest-service && python main.py &

# 4. å¯åŠ¨å‰ç«¯
cd frontend && npm start
```

**å¥åº·æ£€æŸ¥**:
```bash
# ç½‘å…³å¥åº·çŠ¶æ€
curl http://localhost:8080/gateway/health

# æŸ¥çœ‹è·¯ç”±é…ç½®
curl http://localhost:8080/gateway/routes

# Legacyå¥åº·çŠ¶æ€
curl http://localhost:9000/api/health
```

### åˆ‡æ¢æ¨¡å¼

**å¯ç”¨ç½‘å…³æ¨¡å¼**:
```bash
# frontend/.env.development
REACT_APP_USE_API_GATEWAY=true
```

**åˆ‡å›ç›´è¿æ¨¡å¼**(è°ƒè¯•ç”¨):
```bash
# frontend/.env.development
REACT_APP_USE_API_GATEWAY=false
```

### ç›‘æ§æŒ‡æ ‡

**PrometheusæŒ‡æ ‡**:
```bash
# è®¿é—®ç½‘å…³ç›‘æ§
curl http://localhost:8080/metrics
```

**æ—¥å¿—æŸ¥çœ‹**:
```bash
# ç½‘å…³æ—¥å¿—
tail -f /tmp/gateway.log

# signal-apiæ—¥å¿—
tail -f /tmp/signal-api.log

# Legacyæ—¥å¿—
tail -f backend/logs/dongfeng.log
```

---

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œé£é™©

### å½“å‰é—®é¢˜

1. **WebSocketæœåŠ¡æœªå¯åŠ¨**
   - **å½±å“**: å®æ—¶æ¨é€åŠŸèƒ½ä¸å¯ç”¨
   - **è§£å†³**: å¯åŠ¨signal-streameræœåŠ¡

2. **å‰ç«¯æœªåˆ‡æ¢åˆ°ç½‘å…³**
   - **å½±å“**: ä»åœ¨ç›´è¿Legacy
   - **è§£å†³**: é‡å¯å‰ç«¯æœåŠ¡

3. **ç­–ç•¥å¼•æ“æœªå¯åŠ¨**
   - **å½±å“**: æ–°ç­–ç•¥åŠŸèƒ½ä¸å¯ç”¨
   - **è§£å†³**: å¯åŠ¨strategy-engineæœåŠ¡

### æ½œåœ¨é£é™©

1. **æ€§èƒ½å½±å“**
   - é£é™©: ç½‘å…³å¢åŠ 1-5mså»¶è¿Ÿ
   - ç¼“è§£: å·²æµ‹è¯•Legacyè·¯ç”±å“åº”<3ms
   - ç›‘æ§: PrometheusæŒ‡æ ‡æŒç»­è·Ÿè¸ª

2. **å•ç‚¹æ•…éšœ**
   - é£é™©: ç½‘å…³å®•æœºå¯¼è‡´å…¨ç³»ç»Ÿä¸å¯ç”¨
   - ç¼“è§£: å‰ç«¯å¯å¿«é€Ÿåˆ‡å›ç›´è¿æ¨¡å¼
   - æ”¹è¿›: Phase 3 éƒ¨ç½²å¤šèŠ‚ç‚¹ç½‘å…³+è´Ÿè½½å‡è¡¡

3. **æ•°æ®ä¸€è‡´æ€§**
   - é£é™©: æ–°æ—§æœåŠ¡æ•°æ®ä¸ä¸€è‡´
   - ç¼“è§£: Phase 2 ä¸¥æ ¼éªŒè¯æ•°æ®ä¸€è‡´æ€§
   - ç›‘æ§: å®šæœŸå¯¹æ¯”æ–°æ—§ç³»ç»Ÿè¾“å‡º

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¶æ„ç»Ÿä¸€è¿ç§»è®¡åˆ’](docs/æ¶æ„ç»Ÿä¸€è¿ç§»è®¡åˆ’.md) - æ€»ä½“è¿ç§»è§„åˆ’
- [é¡¹ç›®çŠ¶æ€](PROJECT_STATUS.md) - å½“å‰ç‰ˆæœ¬çŠ¶æ€
- [README](README.md) - é¡¹ç›®è¯´æ˜

---

## ğŸ‘¥ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·è”ç³»é¡¹ç›®è´Ÿè´£äººã€‚

---

**æ€»ç»“**: Phase 1 æ ¸å¿ƒç›®æ ‡å·²è¾¾æˆ,APIç½‘å…³æˆåŠŸä¸Šçº¿,æ–°æ—§ç³»ç»Ÿå¯é€šè¿‡ç»Ÿä¸€å…¥å£è®¿é—®ã€‚ä¸‹ä¸€æ­¥å°†å®Œæˆå‰©ä½™æœåŠ¡å¯åŠ¨å’Œå‰ç«¯åˆ‡æ¢,ç„¶åè¿›å…¥Phase 2çš„ä¸šåŠ¡é€»è¾‘è¿ç§»é˜¶æ®µã€‚
