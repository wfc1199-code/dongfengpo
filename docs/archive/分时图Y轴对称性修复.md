# åˆ†æ—¶å›¾Yè½´å¯¹ç§°æ€§ä¿®å¤
> æ—¥æœŸ: 2025-11-24 21:15
> é—®é¢˜: 10%æ¶¨åœè‚¡ç¥¨åˆ†æ—¶å›¾Yè½´æ˜¾ç¤ºä¸å¯¹ç§°

## é—®é¢˜æ ¹æº

### åŸå§‹è®¡ç®—æ–¹å¼
```typescript
// âŒ è¿™ç§æ–¹å¼æ•°å€¼ä¸Šçœ‹ä¼¼æ­£ç¡®ï¼Œä½†å¯èƒ½å¯¼è‡´0è½´ä¸åœ¨ä¸­é—´
const yAxisMax = yesterdayClose * (1 + limitPercent);  // ä¾‹ï¼š32.5 * 1.1 = 35.75
const yAxisMin = yesterdayClose * (1 - limitPercent);  // ä¾‹ï¼š32.5 * 0.9 = 29.25
```

### é—®é¢˜åˆ†æ
è™½ç„¶æ•°å­¦ä¸Š `35.75 - 32.5 = 3.25` å’Œ `32.5 - 29.25 = 3.25` ç›¸ç­‰ï¼Œä½†æ˜¯ï¼š

1. **æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜**ï¼š
   - JavaScriptæµ®ç‚¹è¿ç®—å¯èƒ½äº§ç”Ÿå¾®å°è¯¯å·®
   - `32.5 * 1.1` å¯èƒ½å¾—åˆ° `35.750000000000007`
   - `32.5 * 0.9` å¯èƒ½å¾—åˆ° `29.249999999999996`

2. **ECharts intervalè®¡ç®—**ï¼š
   - ä½¿ç”¨ `interval = (max - min) / 4` ç­‰åˆ†Yè½´
   - ä¸èƒ½ä¿è¯æ˜¨æ”¶ä»·æ­£å¥½è½åœ¨æŸä¸ªåˆ»åº¦ç‚¹ä¸Š
   - å¯¼è‡´0è½´ï¼ˆé»„çº¿ï¼‰ä¸åœ¨å›¾è¡¨æ­£ä¸­é—´

3. **è§†è§‰ä¸å¯¹ç§°**ï¼š
   - 0è½´ä¸Šæ–¹ç©ºé—´ â‰  0è½´ä¸‹æ–¹ç©ºé—´
   - æ”¯æ’‘å‹åŠ›çº¿ä½ç½®çœ‹èµ·æ¥ä¸å¯¹
   - ç”¨æˆ·æ„Ÿè§‰"æ¶¨è·Œå¹…é™åˆ¶ä¸å¯¹"

## ä¿®å¤æ–¹æ¡ˆ

### 1. ç¡®ä¿æ•°å­¦å¯¹ç§°æ€§
```typescript
// âœ… å…ˆè®¡ç®—å•è¾¹èŒƒå›´ï¼Œå†åŠ å‡ï¼Œç¡®ä¿ç»å¯¹å¯¹ç§°
const priceRange = yesterdayClose * limitPercent;  // å•è¾¹èŒƒå›´
const yAxisMax = yesterdayClose + priceRange;      // ä¸Šæ¶¨
const yAxisMin = yesterdayClose - priceRange;      // ä¸‹è·Œ

// éªŒè¯å¯¹ç§°æ€§
const upperRange = yAxisMax - yesterdayClose;
const lowerRange = yesterdayClose - yAxisMin;
// upperRange === lowerRangeï¼ˆç»å¯¹ç›¸ç­‰ï¼‰
```

### 2. ä½¿ç”¨splitNumberæ›¿ä»£interval
```typescript
// âŒ æ—§æ–¹å¼ï¼šæ‰‹åŠ¨æŒ‡å®šé—´éš”
interval: (yAxisMax - yAxisMin) / 4  // å¯èƒ½å¯¼è‡´åˆ»åº¦ä¸åˆç†

// âœ… æ–°æ–¹å¼ï¼šè®©EChartsæ™ºèƒ½åˆ†å‰²
splitNumber: 4  // EChartsä¼šè‡ªåŠ¨è®¡ç®—åˆç†çš„åˆ»åº¦ç‚¹
```

### 3. æ·»åŠ å¯¹ç§°æ€§éªŒè¯
```typescript
// åœ¨æ§åˆ¶å°è¾“å‡ºéªŒè¯ä¿¡æ¯
debugLog(`ğŸ“Š Yè½´èŒƒå›´è®¡ç®—: è‚¡ç¥¨=${code}(${boardType}), æ˜¨æ”¶=${yesterday}`);
debugLog(`   ä¸Š=${upperRange}, ä¸‹=${lowerRange}, å¯¹ç§°=${isSymmetric ? 'âœ“' : 'âœ—'}`);
```

## ä¿®å¤å¯¹æ¯”

### ä¿®å¤å‰ï¼ˆ002864 ä¸»æ¿10%ï¼‰
```
æ˜¨æ”¶ä»·: 32.50
è®¡ç®—æ–¹å¼: 32.5 * 1.1 = 35.75, 32.5 * 0.9 = 29.25

å¯èƒ½çš„é—®é¢˜:
- Yè½´: [29.25, 35.75]
- interval: 1.625
- åˆ»åº¦ç‚¹: 29.25, 30.875, 32.5, 34.125, 35.75
- 0è½´åœ¨æ­£ä¸­é—´åˆ»åº¦ï¼Œä½†ç”±äºæµ®ç‚¹è¯¯å·®å¯èƒ½åç§»
```

### ä¿®å¤åï¼ˆ002864 ä¸»æ¿10%ï¼‰
```
æ˜¨æ”¶ä»·: 32.50
è®¡ç®—æ–¹å¼: 
  priceRange = 32.5 * 0.1 = 3.25
  yAxisMax = 32.5 + 3.25 = 35.75
  yAxisMin = 32.5 - 3.25 = 29.25

ä¿è¯:
- Yè½´: [29.25, 35.75]
- ä¸Šæ–¹ç©ºé—´: 35.75 - 32.5 = 3.25
- ä¸‹æ–¹ç©ºé—´: 32.5 - 29.25 = 3.25
- ç»å¯¹å¯¹ç§°ï¼
```

## æµ‹è¯•ç”¨ä¾‹

### æ¡ˆä¾‹1: ç›˜é¾™è¯ä¸š (002864) - ä¸»æ¿10%
```
æ˜¨æ”¶: 32.50
æ¶¨åœ: 35.75 (+10.00%)
è·Œåœ: 29.25 (-10.00%)

Yè½´èŒƒå›´: [29.25, 35.75]
0è½´ä½ç½®: 32.50ï¼ˆæ­£ä¸­é—´ï¼‰
ä¸Šæ–¹ç©ºé—´: 3.25
ä¸‹æ–¹ç©ºé—´: 3.25
```

### æ¡ˆä¾‹2: é‡‘æ©™å­ (688291) - ç§‘åˆ›æ¿20%
```
æ˜¨æ”¶: 29.03
æ¶¨åœ: 34.84 (+20.00%)
è·Œåœ: 23.22 (-20.00%)

Yè½´èŒƒå›´: [23.22, 34.84]
0è½´ä½ç½®: 29.03ï¼ˆæ­£ä¸­é—´ï¼‰
ä¸Šæ–¹ç©ºé—´: 5.81
ä¸‹æ–¹ç©ºé—´: 5.81
```

### æ¡ˆä¾‹3: å¹³å®‰é“¶è¡Œ (000001) - ä¸»æ¿10%
```
æ˜¨æ”¶: 10.00
æ¶¨åœ: 11.00 (+10.00%)
è·Œåœ: 9.00 (-10.00%)

Yè½´èŒƒå›´: [9.00, 11.00]
0è½´ä½ç½®: 10.00ï¼ˆæ­£ä¸­é—´ï¼‰
ä¸Šæ–¹ç©ºé—´: 1.00
ä¸‹æ–¹ç©ºé—´: 1.00
```

## è§†è§‰éªŒè¯æ–¹æ³•

### 1. 0è½´ä½ç½®æ£€æŸ¥
æ‰“å¼€åˆ†æ—¶å›¾ï¼Œè§‚å¯Ÿé»„è‰²è™šçº¿ï¼ˆ0è½´/æ˜¨æ”¶ä»·çº¿ï¼‰ï¼š
- âœ… åº”è¯¥åœ¨å›¾è¡¨å‚ç›´æ–¹å‘çš„æ­£ä¸­é—´
- âœ… ä¸Šæ–¹ç©ºç™½å’Œä¸‹æ–¹ç©ºç™½åº”è¯¥å®Œå…¨ç›¸ç­‰
- âŒ å¦‚æœ0è½´åä¸Šæˆ–åä¸‹ï¼Œè¯´æ˜Yè½´ä¸å¯¹ç§°

### 2. åˆ»åº¦æ£€æŸ¥
æŸ¥çœ‹å·¦ä¾§ç™¾åˆ†æ¯”åˆ»åº¦ï¼š
- âœ… ä¸»æ¿åº”è¯¥æ˜¯ï¼š-10%, -5%, 0%, +5%, +10%
- âœ… ç§‘åˆ›æ¿/åˆ›ä¸šæ¿åº”è¯¥æ˜¯ï¼š-20%, -10%, 0%, +10%, +20%
- âœ… 0%åº”è¯¥åœ¨ä¸­é—´ä½ç½®

### 3. æ”¯æ’‘å‹åŠ›çº¿æ£€æŸ¥
è§‚å¯Ÿç»¿è‰²æ”¯æ’‘çº¿å’Œçº¢è‰²å‹åŠ›çº¿ï¼š
- âœ… åº”è¯¥åœ¨åˆç†çš„ä»·æ ¼ä½ç½®
- âœ… ä¸åº”è¯¥è¶…å‡ºYè½´èŒƒå›´
- âœ… æ ‡ç­¾ä½ç½®åº”è¯¥å¯¹é½

## æµè§ˆå™¨æ§åˆ¶å°éªŒè¯

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹Consoleè¾“å‡ºï¼š

```
ğŸ” è‚¡ç¥¨ä»£ç åˆ†æ: åŸå§‹=002864, çº¯ä»£ç =002864
ğŸ“Š Yè½´èŒƒå›´è®¡ç®—: è‚¡ç¥¨=002864(ä¸»æ¿), æ˜¨æ”¶=32.50, æ¶¨è·Œå¹…é™åˆ¶=10%
   Yè½´èŒƒå›´=[29.25, 35.75], ä¸Š=3.25, ä¸‹=3.25, å¯¹ç§°=âœ“
```

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- `å¯¹ç§°=âœ“` è¡¨ç¤ºYè½´å®Œå…¨å¯¹ç§°
- `ä¸Š=3.25, ä¸‹=3.25` æ•°å€¼å¿…é¡»å®Œå…¨ç›¸ç­‰
- å¦‚æœæ˜¾ç¤º `å¯¹ç§°=âœ—`ï¼Œè¯´æ˜è¿˜æœ‰é—®é¢˜

## å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: 0è½´è¿˜æ˜¯ä¸åœ¨ä¸­é—´æ€ä¹ˆåŠï¼Ÿ
æ£€æŸ¥ç‚¹ï¼š
1. ç¡®è®¤ `finalYesterdayClose` çš„å€¼æ­£ç¡®
2. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤º `å¯¹ç§°=âœ“`
3. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ—§çš„ç¼“å­˜æ•°æ®ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰

### Q2: å·¦ä¾§ç™¾åˆ†æ¯”åˆ»åº¦ä¸å¯¹ç§°ï¼Ÿ
```typescript
// æ£€æŸ¥å·¦ä¾§Yè½´çš„é…ç½®
axisLabel: {
  formatter: (value) => {
    const percent = ((value - basePrice) / basePrice) * 100;
    return `${percent >= 0 ? '+' : ''}${percent.toFixed(2)}%`;
  }
}
```
ç¡®ä¿ `basePrice` ä½¿ç”¨çš„æ˜¯ `finalYesterdayClose`ã€‚

### Q3: ç§‘åˆ›æ¿å’Œä¸»æ¿éƒ½ä¸å¯¹ï¼Ÿ
æ£€æŸ¥è‚¡ç¥¨ä»£ç è¯†åˆ«é€»è¾‘ï¼š
```typescript
const pureCode = stockCode.replace(/^(sh|sz|hk)/, '');
if (pureCode.startsWith('688')) {
  limitPercent = 0.2;  // ç§‘åˆ›æ¿
}
```

## ä»£ç ä¿®æ”¹æ€»ç»“

### ä¿®æ”¹æ–‡ä»¶
- âœ… `frontend/src/components/TimeShareChartFixed.tsx`

### æ ¸å¿ƒæ”¹åŠ¨
1. **Yè½´èŒƒå›´è®¡ç®—**ï¼ˆç¬¬268-280è¡Œï¼‰
   ```typescript
   // æ”¹ä¸ºï¼špriceRangeæ–¹å¼ï¼Œç¡®ä¿å¯¹ç§°
   const priceRange = finalYesterdayClose * limitPercent;
   const yAxisMax = finalYesterdayClose + priceRange;
   const yAxisMin = finalYesterdayClose - priceRange;
   ```

2. **Yè½´é…ç½®**ï¼ˆç¬¬365è¡Œï¼‰
   ```typescript
   // æ”¹ä¸ºï¼šsplitNumberæ›¿ä»£interval
   splitNumber: 4  // è®©EChartsæ™ºèƒ½åˆ†å‰²
   ```

3. **å¯¹ç§°æ€§éªŒè¯**ï¼ˆç¬¬274-280è¡Œï¼‰
   ```typescript
   // æ–°å¢ï¼šéªŒè¯å¹¶è¾“å‡ºå¯¹ç§°æ€§
   const upperRange = yAxisMax - finalYesterdayClose;
   const lowerRange = finalYesterdayClose - yAxisMin;
   const isSymmetric = Math.abs(upperRange - lowerRange) < 0.01;
   debugLog(`å¯¹ç§°=${isSymmetric ? 'âœ“' : 'âœ—'}`);
   ```

## æµ‹è¯•æ­¥éª¤

1. **å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨**ï¼šCmd+Shift+Rï¼ˆMacï¼‰
2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**ï¼šF12 â†’ Console
3. **æµ‹è¯•ä¸»æ¿è‚¡ç¥¨**ï¼š002864
   - æŸ¥çœ‹0è½´æ˜¯å¦åœ¨ä¸­é—´
   - æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º `å¯¹ç§°=âœ“`
4. **æµ‹è¯•ç§‘åˆ›æ¿è‚¡ç¥¨**ï¼š688291
   - æŸ¥çœ‹0è½´æ˜¯å¦åœ¨ä¸­é—´
   - ç¡®è®¤20%æ¶¨è·Œå¹…èŒƒå›´
5. **æµ‹è¯•å…¶ä»–è‚¡ç¥¨**ï¼š
   - åˆ›ä¸šæ¿ï¼š300750
   - å¤§ç›˜è‚¡ï¼š600519

## é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰ âŒ
```
0è½´ä½ç½®: å¯èƒ½åä¸Šæˆ–åä¸‹
ä¸Šæ–¹ç©ºé—´: 3.26
ä¸‹æ–¹ç©ºé—´: 3.24
è§†è§‰æ•ˆæœ: ä¸å¯¹ç§°ï¼Œä¸èˆ’æœ
```

### ä¿®å¤å âœ…
```
0è½´ä½ç½®: æ­£ä¸­é—´
ä¸Šæ–¹ç©ºé—´: 3.25
ä¸‹æ–¹ç©ºé—´: 3.25
è§†è§‰æ•ˆæœ: å®Œç¾å¯¹ç§°ï¼Œèˆ’é€‚
```

---

**è¯·ç«‹å³åˆ·æ–°æµè§ˆå™¨æµ‹è¯•ï¼åº”è¯¥èƒ½çœ‹åˆ°å®Œç¾å¯¹ç§°çš„åˆ†æ—¶å›¾äº†ï¼**
