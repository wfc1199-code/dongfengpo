# 创业板301股票涨跌幅显示修复
> 日期: 2025-11-24 21:50
> 问题: 301136招标股份只显示10%涨跌幅，应该显示20%

## 问题根源

### 股票代码规则不完整

**创业板股票代码范围**：
- **300xxx**: 老创业板（2009年上市）
- **301xxx**: 新创业板（2020年注册制改革后上市）
- **涨跌幅限制**: 统一为 ±20%

**原始代码问题**：
```typescript
// ❌ 只判断300开头
} else if (pureCode.startsWith('300')) {
  limitPercent = 0.2;
  boardType = '创业板';
}
```

**问题**：
- 只匹配了 `300` 开头的老创业板
- **遗漏了 `301` 开头的新创业板**
- 导致301开头的股票被当成主板处理（10%涨跌幅）

## 修复方案

### 修改判断条件

```typescript
// ✅ 修改为匹配所有30x开头
} else if (pureCode.startsWith('30')) {
  // 创业板：300老创业板、301新创业板（注册制）
  limitPercent = 0.2;
  boardType = '创业板';
}
```

### 优化代码逻辑

同时优化了科创板的判断，合并688和689：

```typescript
// ✅ 科创板也合并判断
if (pureCode.startsWith('688') || pureCode.startsWith('689')) {
  limitPercent = 0.2;
  boardType = '科创板';
}
```

## 完整的股票代码规则

### A股市场板块划分

| 板块 | 代码范围 | 涨跌幅限制 | 示例 |
|------|---------|-----------|------|
| **主板（沪）** | 600/601/603/605 | ±10% | 600519 贵州茅台 |
| **主板（深）** | 000/001/002/003 | ±10% | 000001 平安银行 |
| **科创板** | 688/689 | ±20% | 688981 中芯国际 |
| **创业板（老）** | 300 | ±20% | 300750 宁德时代 |
| **创业板（新）** | 301 | ±20% | 301136 招标股份 |
| **北交所** | 8xxxxx | ±30% | 835185 贝特瑞 |
| **港股** | hkxxxx | 无限制 | hk00700 腾讯 |

### 特殊情况

**ST股票**（*ST、ST开头）：
- 涨跌幅限制：±5%
- 注意：目前代码未特殊处理ST股票

**新股上市首日**：
- 科创板/创业板：±20% → 无涨跌幅限制
- 主板：±10% → 首日涨幅最高44%
- 注意：目前代码未特殊处理新股

## 测试用例

### 测试1: 301136 招标股份（新创业板）

**修复前**：
```
股票代码: 301136
识别结果: 主板（错误）
涨跌幅: ±10%
Y轴范围: 错误
```

**修复后**：
```
股票代码: 301136
识别结果: 创业板（正确）✓
涨跌幅: ±20%
Y轴范围: 正确
```

### 测试2: 300750 宁德时代（老创业板）

```
股票代码: 300750
识别结果: 创业板 ✓
涨跌幅: ±20%
Y轴范围: 正确
```

### 测试3: 688981 中芯国际（科创板）

```
股票代码: 688981
识别结果: 科创板 ✓
涨跌幅: ±20%
Y轴范围: 正确
```

## 修改文件

- ✅ `frontend/src/components/TimeShareChartFixed.tsx`
  - 第252行：改为 `pureCode.startsWith('30')`
  - 第249行：合并688和689的判断

## 验证方法

### 1. 浏览器控制台验证

打开F12，查看日志：

**修复前（301136）**：
```
🔍 股票代码分析: 原始=301136, 纯代码=301136
📊 Y轴范围计算: 股票=301136(主板), 昨收=XX.XX, 涨跌幅限制=10% ❌
```

**修复后（301136）**：
```
🔍 股票代码分析: 原始=301136, 纯代码=301136
📊 Y轴范围计算: 股票=301136(创业板), 昨收=XX.XX, 涨跌幅限制=20% ✓
```

### 2. 视觉验证

查看301136的分时图：
- ✅ 左侧Y轴刻度应显示：-20%, -10%, 0%, +10%, +20%
- ✅ 0轴（黄色虚线）应在图表正中间
- ✅ 上下空间应完全相等

### 3. 测试其他301股票

创业板注册制新股（301开头）列表：
```
301136 招标股份
301111 粤万年青
301123 奕东电子
301169 零点有数
301156 华中数控
... 等
```

所有这些股票现在应该都能正确识别为创业板（20%涨跌幅）。

## 历史遗留问题

### 为什么之前只判断了300？

1. **代码编写时间较早**：301开头的创业板是2020年注册制后才出现
2. **测试覆盖不全**：测试时主要用300开头的老创业板股票
3. **规则理解不深**：没有考虑到创业板代码会扩展到301

## 相关修复历史

1. **科创板识别** - ✅ 已修复（688开头）
2. **创业板老股** - ✅ 已修复（300开头）
3. **创业板新股** - ✅ 本次修复（301开头）
4. **Y轴对称性** - ✅ 已修复
5. **缓存优化** - ✅ 已完成

## 后续建议

### 1. 完善ST股票处理
```typescript
// 建议添加
if (stockCode.includes('ST')) {
  limitPercent = 0.05; // ST股票5%
  boardType = 'ST股票';
}
```

### 2. 新股首日处理
```typescript
// 需要从后端获取上市日期
if (isIPOFirstDay) {
  limitPercent = 1.0; // 首日无限制
  boardType = '新股首日';
}
```

### 3. 后端统一处理
更好的方案是在后端返回涨跌幅限制：
```json
{
  "code": "301136",
  "name": "招标股份",
  "board": "创业板",
  "limit_percent": 0.2,
  "yesterday_close": 35.50
}
```

---

**现在请强制刷新浏览器（Cmd+Shift+R），301136应该能正确显示20%涨跌幅了！**
