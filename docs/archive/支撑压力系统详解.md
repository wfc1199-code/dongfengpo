# 支撑压力系统详解

## 一、系统概述

支撑压力系统是技术分析中的核心概念，用于识别价格可能反弹或受阻的关键价位。我们的系统实现了多种计算方法和评级机制，为交易决策提供科学依据。

## 二、核心概念

### 2.1 支撑位 (Support)
- **定义**: 价格下跌时可能获得支撑并反弹的价位
- **形成原理**: 大量买盘在此价位聚集，形成价格"底部"
- **特征**: 价格多次触及该位置后反弹

### 2.2 压力位 (Resistance)  
- **定义**: 价格上涨时可能遇到阻力并回落的价位
- **形成原理**: 大量卖盘在此价位聚集，形成价格"顶部"
- **特征**: 价格多次触及该位置后回落

## 三、计算方法

### 3.1 通达信固定支撑压力法

#### 计算公式
```
价格区间 = 日内最高价 - 日内最低价
固定阻力 = 日内最低价 + 价格区间 × 7/8
固定支撑 = 日内最低价 + 价格区间 × 0.5/8
中轴线 = 日内最低价 + 价格区间 × 0.5
```

#### 周期设置
- **5分钟线**: 使用最近48个周期（一天）
- **15分钟线**: 使用最近16个周期（一天）  
- **日线**: 使用最近20个交易日

#### 示例计算
```
假设某股票日内数据：
- 最高价: 1420 HKD
- 最低价: 1380 HKD
- 价格区间: 1420 - 1380 = 40 HKD

计算结果：
- 固定阻力: 1380 + 40 × 7/8 = 1415 HKD
- 固定支撑: 1380 + 40 × 0.5/8 = 1382.5 HKD  
- 中轴线: 1380 + 40 × 0.5 = 1400 HKD
```

### 3.2 动态支撑压力识别

#### 算法流程
1. **极值点识别**: 使用滑动窗口识别局部最高点和最低点
2. **价格聚类**: 将相近的价格点聚类，形成支撑压力区域
3. **强度计算**: 基于触及次数、时间跨度、成交量等因素计算强度

#### 关键参数
```python
window_size = 20          # 极值点识别窗口
min_touches = 3           # 最小触及次数
price_tolerance = 0.002   # 价格容忍度(0.2%)
lookback_periods = 100    # 回看周期数
```

### 3.3 基于成交量的支撑压力

#### 核心思想
成交量是价格运动的"燃料"，高成交量区域往往形成重要的支撑压力位。

#### 计算步骤
1. **成交量百分位计算**: 计算当前成交量在历史数据中的百分位
2. **ATR计算**: 计算平均真实波幅，用于价格带宽度
3. **支撑阻力带**: 基于成交量和ATR计算动态价格带

#### 关键指标
```python
length = 25                    # 计算周期
resistance_threshold = 80      # 阻力位成交量阈值(%)
support_threshold = 80         # 支撑位成交量阈值(%)
bars_threshold = 50           # K线着色阈值(%)
```

## 四、强度评级系统

### 4.1 评级标准
- **S级 (80分以上)**: 极强支撑压力位
- **A级 (60-80分)**: 强支撑压力位  
- **B级 (40-60分)**: 中等支撑压力位
- **C级 (20-40分)**: 弱支撑压力位
- **D级 (20分以下)**: 极弱支撑压力位

### 4.2 评分因素及权重

| 因素 | 权重 | 说明 |
|------|------|------|
| 触及次数 | 25% | 价格触及该位置的次数 |
| 成交量 | 20% | 该价位的成交量强度 |
| 时间跨度 | 15% | 从首次到最近触及的时间跨度 |
| 反弹强度 | 20% | 触及后的价格反弹/回落幅度 |
| 多周期确认 | 10% | 多个时间周期的确认 |
| 最近触及 | 10% | 最近一次触及的时间 |

### 4.3 评分计算示例

```python
# 示例：某支撑位评分计算
touches_score = 3 * 5 = 15分          # 触及3次
volume_score = 1.5 * 10 = 15分        # 成交量比率1.5倍
time_span_score = 0.6 * 40 = 24分     # 时间跨度60%
bounce_score = 0.03 * 100 = 3分       # 反弹3%
multi_timeframe_score = 2 * 12.5 = 25分  # 2个周期确认
recency_score = 0.8 * 10 = 8分        # 最近触及80%位置

总分 = 15*0.25 + 15*0.20 + 24*0.15 + 3*0.20 + 25*0.10 + 8*0.10
    = 3.75 + 3.0 + 3.6 + 0.6 + 2.5 + 0.8
    = 14.25分 (C级)
```

## 五、交易应用策略

### 5.1 支撑位交易策略

#### 买入信号
- 价格接近S级或A级支撑位
- 成交量放大确认
- 出现反转K线形态

#### 止损设置
- 支撑位下方1-2%
- 或跌破支撑位立即止损

#### 目标价位
- 下一个阻力位
- 或支撑位上方3-5%

### 5.2 压力位交易策略

#### 卖出信号  
- 价格接近S级或A级压力位
- 成交量萎缩
- 出现反转K线形态

#### 止损设置
- 压力位上方1-2%
- 或突破压力位立即止损

#### 目标价位
- 下一个支撑位
- 或压力位下方3-5%

### 5.3 突破策略

#### 向上突破
- 价格突破压力位并站稳
- 成交量显著放大
- 旧压力位变为新支撑位

#### 向下突破
- 价格跌破支撑位
- 成交量放大确认
- 旧支撑位变为新压力位

## 六、系统优势

### 6.1 多维度分析
- 结合价格、成交量、时间等多个维度
- 动态调整支撑压力位
- 多时间周期确认

### 6.2 量化评级
- 科学的评分体系
- 明确的交易建议
- 风险等级评估

### 6.3 实时更新
- 实时计算支撑压力位
- 动态调整强度评级
- 及时交易信号提醒

## 七、注意事项

### 7.1 市场环境
- 支撑压力在趋势市场中更有效
- 震荡市场中效果更佳
- 单边市场中可能失效

### 7.2 风险控制
- 支撑压力位不是100%准确
- 需要结合其他技术指标
- 严格控制止损

### 7.3 资金管理
- 分批建仓
- 控制单次风险
- 保持资金流动性

## 八、技术实现

### 8.1 后端架构
```
backend/
├── core/support_resistance/
│   ├── dynamic_sr.py          # 动态支撑压力识别
│   ├── strength_rating.py     # 强度评级系统
│   ├── volume_profile.py      # 成交量分析
│   └── multi_timeframe.py     # 多周期分析
├── api/support_resistance_tdx.py  # 通达信风格API
└── core/support_resistance_volume.py  # 成交量支撑压力
```

### 8.2 前端集成
```typescript
// 支撑压力Hook
const { levels, analysis, alerts } = useSupportResistance({
  stockCode: '000001',
  enabled: true,
  updateInterval: 5000
});

// 通达信风格Hook  
const { levels: tdxLevels } = useSupportResistanceTDX({
  stockCode: '000001',
  enabled: true
});
```

### 8.3 数据流程
1. **数据获取**: 从数据源获取K线数据
2. **计算分析**: 多种算法并行计算支撑压力位
3. **强度评级**: 综合评分并确定等级
4. **结果输出**: 返回结构化的支撑压力信息
5. **前端展示**: 在图表上可视化显示

## 九、总结

支撑压力系统是技术分析的重要工具，通过科学的计算方法和评级体系，为交易决策提供客观依据。系统结合了传统技术分析理论和现代量化方法，实现了多维度、多周期的综合分析，提高了交易决策的准确性和可靠性。

在实际应用中，需要结合市场环境、风险偏好和个人交易风格，灵活运用支撑压力位进行交易决策，并始终保持严格的风险控制意识。
