# 期权与股票数据格式统一

## 🎯 问题发现

用户提示"用股票一样的数据源试一下"，发现关键差异：

### Before（修改前）

**股票API返回**：
```json
{
  "minute_data": [...],  // 数据在这里
  "code": "000001",
  "name": "平安银行"
}
```

**期权API返回**：
```json
{
  "data": [...],  // 数据在这里
  "code": "MO2511-C-7400", 
  "name": "..."
}
```

### 问题

虽然前端有兼容处理，但：
1. 字段名不一致可能导致某些边缘情况处理不当
2. 增加了前端的复杂度
3. 不符合统一API设计原则

---

## ✅ 解决方案

修改期权API，**同时提供两个字段**：

```python
# modules/options/service.py Line 135-137
if result.get('data'):
    result['minute_data'] = result['data']
```

### After（修改后）

**期权API返回**：
```json
{
  "data": [...],          // 保持原有字段（向后兼容）
  "minute_data": [...],   // 新增字段（与股票一致）
  "code": "MO2511-C-7400"
}
```

---

## 📊 验证

```bash
curl "http://localhost:9000/api/options/MO2511-C-7400/minute"
```

**预期结果**：
- ✅ `data` 字段存在
- ✅ `minute_data` 字段存在  
- ✅ 两个字段内容相同
- ✅ 数据实时（最新到13:47+）

---

## 🎯 前端受益

前端可以统一使用 `minute_data` 字段，不需要区分股票和期权：

```typescript
// 统一处理
const candidatePoints = raw.minute_data || raw.data || [];
```

---

## 📝 测试步骤

1. **后端已重启** ✅
2. **完全关闭浏览器**
3. **重新打开访问** `http://localhost:3000`
4. **查看期权分时图** (MO2511-C-7400)

**预期效果**：
- ✅ 图表显示完整数据（包含下午13:00-14:00的数据）
- ✅ 不再停在11:30
- ✅ 实时更新

---

**修改时间**：2025-10-20 13:50  
**版本**：v6.0 - 数据格式统一（股票格式兼容）
