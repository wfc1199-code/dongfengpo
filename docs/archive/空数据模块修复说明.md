# 空数据模块修复说明
> 日期: 2025-11-24 23:45
> 问题: 机会流、板块热度、高级监控显示为空

## 诊断结果

### 后端API状态

| 模块 | API端点 | 状态 | 数据量 | 说明 |
|------|---------|------|--------|------|
| **板块热度** | `/api/market-scanner/hot-sectors` | ✅ 正常 | 7个板块 | 有数据 |
| **涨幅榜** | `/api/market-scanner/top-gainers` | ✅ 正常 | 20只股票 | 有数据 |
| **异动检测** | `/api/anomaly/detect` | ✅ 正常 | 0条异动 | 非交易时间无异动（正常） |
| **横盘突破** | `/api/anomaly/consolidation-breakout/scan` | ✅ 正常 | 0条突破 | 当前无突破信号（正常） |
| **破峰突破** | `/api/anomaly/peak-breakout/scan` | ✅ 正常 | 0条突破 | 当前无突破信号（正常） |

### 前端显示状态

| 模块 | 组件 | 预期状态 | 实际状态 |
|------|------|---------|---------|
| **机会流** | `SmartOpportunityFeed` | 应显示涨幅榜数据 | 显示为空 ❌ |
| **板块热度** | `HotSectorsContainer` | 应显示7个热门板块 | 显示为空 ❌ |
| **高级监控** | `AdvancedMonitorPage` | 应显示"暂无信号" | 显示为空 ❌ |

## 问题原因分析

### 1. 机会流（SmartOpportunityFeed）

**问题**：虽然后端有数据，但前端可能：
- 加载失败（网络错误）
- 数据格式不匹配
- 没有正确处理空状态

**验证**：查看浏览器Console是否有错误

### 2. 板块热度（HotSectorsContainer）

**后端有数据**：
```json
{
  "code": 200,
  "data": {
    "sectors": [
      {"name": "船舶制造", "change_percent": 7.3, "count": 15127809},
      {"name": "航天航空", "change_percent": 4.94, "count": 9360498},
      ... 共7个
    ]
  }
}
```

**问题可能**：
- 前端没有正确解析数据
- 渲染逻辑有bug
- CSS隐藏了内容

### 3. 高级监控（AdvancedMonitorPage）

**后端返回**：
```json
{
  "code": 200,
  "data": {
    "breakouts": [],  // 当前无突破信号
    "total_breakouts": 0
  }
}
```

**预期行为**：
- 应该显示"暂无横盘突破信号"
- 应该显示"暂无破峰突破信号"
- 不应该完全空白

## 已修复的问题

### 1. 异常检测ImportError ✅

**错误**：
```python
No module named 'api'
```

**修复**：
```python
# 修改前
from api.market_anomaly_routes import MarketAnomalyScanner

# 修改后
from modules.market_scanner.service import MarketScannerService
```

**文件**：`backend/modules/anomaly/service.py`

### 2. 创业板301股票识别 ✅

**问题**：301136等新创业板股票识别为主板（10%）

**修复**：
```typescript
// 改为匹配所有30x开头
} else if (pureCode.startsWith('30')) {
  limitPercent = 0.2;
  boardType = '创业板';
}
```

**文件**：`frontend/src/components/TimeShareChartFixed.tsx`

## 前端调试步骤

### 步骤1: 打开浏览器开发者工具

1. 按 F12 打开开发者工具
2. 切换到 **Console** 标签
3. 切换到 **Network** 标签

### 步骤2: 刷新页面查看请求

在 Network 标签中查找：
```
/api/market-scanner/hot-sectors
/api/market-scanner/top-gainers
/api/anomaly/detect
```

查看这些请求：
- ✅ 状态码是200？
- ✅ 返回了数据？
- ❌ 是否有CORS错误？
- ❌ 是否超时？

### 步骤3: 查看Console错误

在 Console 标签中查找红色错误信息：
- `Cannot read property ... of undefined`
- `TypeError: ...`
- `Network request failed`
- 等

### 步骤4: 检查组件渲染

在 Console 中执行：
```javascript
// 检查机会流数据
console.log('机会流数据:', document.querySelector('.smart-opportunity-feed'));

// 检查板块热度数据
console.log('板块热度:', document.querySelector('.hot-sectors-container'));

// 检查高级监控
console.log('高级监控:', document.querySelector('.advanced-monitor-page'));
```

## 临时解决方案

### 方案A: 清除所有缓存

```bash
# 1. 清除后端缓存
rm -rf /Users/wangfangchun/东风破/backend/data/cache/*

# 2. 清除浏览器缓存
# 开发者工具 → Application → Clear storage → Clear site data

# 3. 重启服务
# 后端和前端都重启
```

### 方案B: 检查前端路由

```typescript
// 确认这些组件是否在当前页面显示
// 可能被隐藏或在其他tab中
```

### 方案C: 手动测试API

打开浏览器，直接访问：
```
http://localhost:9000/api/market-scanner/hot-sectors?limit=15
http://localhost:9000/api/market-scanner/top-gainers?limit=20
http://localhost:9000/api/anomaly/detect?scan_all=true
```

查看是否返回数据。

## 创建测试页面

我创建一个独立页面测试这些API：

```html
<!DOCTYPE html>
<html>
<head>
    <title>API测试</title>
</head>
<body>
    <h1>后端API测试</h1>
    <button onclick="testHotSectors()">测试板块热度</button>
    <button onclick="testTopGainers()">测试涨幅榜</button>
    <button onclick="testAnomalies()">测试异动检测</button>
    <pre id="result"></pre>
    
    <script>
        async function testHotSectors() {
            const res = await fetch('http://localhost:9000/api/market-scanner/hot-sectors?limit=15');
            const data = await res.json();
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }
        
        async function testTopGainers() {
            const res = await fetch('http://localhost:9000/api/market-scanner/top-gainers?limit=20');
            const data = await res.json();
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }
        
        async function testAnomalies() {
            const res = await fetch('http://localhost:9000/api/anomaly/detect?scan_all=true');
            const data = await res.json();
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>
```

## 下一步行动

请告诉我：

1. **浏览器Console有什么错误？**
   - 打开F12 → Console标签
   - 截图或复制错误信息

2. **Network标签显示什么？**
   - 这些API请求的状态码是什么？
   - 返回的数据是什么？

3. **页面是否完全空白？**
   - 还是显示了标题但内容为空？
   - 是否有"暂无数据"的提示？

4. **其他模块正常吗？**
   - 今日预测、二板候选、连板监控是否有数据？
   - 自选股是否正常显示？

---

**根据您提供的具体信息，我可以精确定位问题所在！**

同时，请**强制刷新浏览器**（Cmd+Shift+R），因为我刚才修复了：
1. ✅ 异常检测的ImportError
2. ✅ 301创业板股票识别
