# 连板热度重构报告

## 重构目标
将"板块热度"功能从基于热门股票聚合改为**基于连板数据的智能热度分析**，提供更精准的板块强度评估。

## 核心改进

### 1. 数据源升级
- **原方案**：使用热门股票榜单聚合计算板块热度
- **新方案**：使用涨停池连板数据进行深度分析

### 2. 热度评分算法

#### 评分公式
```python
heat_score = (
    stock_count * 4.0 +           # 连板股数量权重 40%
    avg_consecutive_days * 15.0 +  # 平均连板天数权重 30%
    max_consecutive * 10.0 +       # 最大连板数权重 20%
    avg_change * 0.5               # 涨幅权重 10%
)
```

#### 强度等级划分
| 热度分数 | 强度等级 | 趋势描述 |
|---------|---------|---------|
| ≥80 | 极强 | 强势爆发 |
| 60-80 | 强 | 强势上涨 |
| 40-60 | 中 | 温和上涨 |
| <40 | 弱 | 震荡整理 |

### 3. 新增数据维度

#### 板块维度
- **连板股数量**：板块内涨停股票数量
- **平均连板天数**：板块内股票平均连板天数
- **最大连板数**：板块内最高连板天数
- **龙头股信息**：自动识别板块龙头股（最高连板数股票）
- **热度评分**：综合评分（0-150+）

#### 龙头股信息
- 股票代码和名称
- 连板天数
- 涨跌幅

## 技术实现

### 后端实现

#### 1. 新增API端点
```
GET /api/market-scanner/continuous-board-heat?limit=15
```

#### 2. 数据处理流程
```
1. 获取涨停池数据（AkShare stock_zt_pool_em）
2. 按行业聚合连板数据
3. 计算各板块热度指标
4. 识别板块龙头股
5. 按热度评分排序
6. 返回Top N板块
```

#### 3. 核心代码
```python
async def get_continuous_board_heat(self, limit: int = 20):
    """获取基于连板数据的板块热度分析"""
    # 1. 获取涨停池数据
    df = await loop.run_in_executor(None, ak.stock_zt_pool_em, datetime.now().strftime("%Y%m%d"))

    # 2. 按行业聚合
    for _, row in df.iterrows():
        consecutive_days = int(row.get('连板数', 1))
        industry = row.get('所属行业', '未知')
        # 聚合统计...

    # 3. 计算热度评分
    heat_score = (
        stock_count * 4.0 +
        avg_consecutive_days * 15.0 +
        max_consecutive * 10.0 +
        avg_change * 0.5
    )
```

### 前端实现

#### 1. 更新API调用
```typescript
// 从热门股票聚合API
const response = await fetch('http://localhost:9000/api/market-scanner/hot-sectors?limit=15');

// 改为连板热度分析API
const response = await fetch('http://localhost:9000/api/market-scanner/continuous-board-heat?limit=15');
```

#### 2. 新增显示字段
```typescript
interface HotSector {
  // 原有字段...

  // 连板热度相关字段
  avg_consecutive_days?: number;      // 平均连板天数
  max_consecutive_days?: number;      // 最大连板数
  strength?: string;                  // 强度等级
  leading_stock?: string;             // 龙头股名称
  leading_stock_code?: string;        // 龙头股代码
  leading_stock_consecutive?: number; // 龙头股连板数
  leading_stock_change?: number;      // 龙头股涨幅
}
```

#### 3. UI增强
- 显示平均连板天数
- 突出显示高连板数（≥3板）
- 龙头股信息标识
- 强度等级徽章

## 数据示例

### API返回示例
```json
{
  "code": 200,
  "data": {
    "sectors": [
      {
        "sector_name": "农药兽药",
        "stock_count": 2,
        "avg_consecutive_days": 4.5,
        "max_consecutive_days": 7,
        "heat_score": 150.51,
        "strength": "极强",
        "trend": "强势爆发",
        "leading_stock": "蓝丰生化",
        "leading_stock_consecutive": 7,
        "leading_stock_change": 10.05
      }
    ],
    "statistics": {
      "total_sectors": 33,
      "total_stocks": 52,
      "avg_heat_score": 92.7
    }
  }
}
```

### 实际热度排行（2025-10-02）

| 排名 | 板块 | 热度 | 强度 | 连板股数 | 平均连板 | 最高连板 | 龙头股 |
|-----|------|------|------|---------|---------|---------|--------|
| 1 | 农药兽药 | 150.51 | 极强 | 2只 | 4.5板 | 7板 | 蓝丰生化(7板) |
| 2 | 工程咨询 | 109.0 | 极强 | 1只 | 4.0板 | 4板 | 华建集团(4板) |
| 3 | 电池 | 75.49 | 强 | 2只 | 2.0板 | 3板 | 天际股份(3板) |
| 4 | 汽车零部 | 68.17 | 强 | 6只 | 1.17板 | 2板 | 山子高科(2板) |
| 5 | 环保行业 | 60.34 | 强 | 3只 | 1.33板 | 2板 | 冠中生态(2板) |

## 优势分析

### 1. 更精准的热度识别
- 基于连板数据，真实反映板块强度
- 自动识别龙头股，把握市场主线

### 2. 多维度评估
- 不仅看涨停数量，更看连板质量
- 平均连板天数反映板块持续性
- 最高连板数反映板块爆发力

### 3. 智能评分系统
- 科学的权重分配
- 清晰的强度分级
- 直观的趋势判断

## 使用场景

### 1. 板块选择
- 快速识别当前市场最强板块
- 找到具有持续性的板块

### 2. 龙头追踪
- 自动识别板块龙头股
- 关注高连板数龙头

### 3. 市场情绪判断
- 通过板块热度分布判断市场情绪
- 识别资金流向

## 测试验证

### 测试页面
创建了独立测试页面 `test_continuous_board_heat.html`，验证：
- 热度评分准确性
- 龙头股识别正确性
- 强度等级划分合理性
- 数据实时性

### 前端集成
- ✅ API调用正常
- ✅ 数据展示完整
- ✅ 连板信息突出
- ✅ 龙头股标识清晰

## 总结

通过本次重构，"板块热度"功能：
- ✅ 数据源更权威（涨停池 vs 热门股票）
- ✅ 算法更科学（多维度评分 vs 简单平均）
- ✅ 信息更丰富（连板+龙头 vs 单一涨幅）
- ✅ 实用性更强（精准捕捉强势板块）

连板热度分析为投资者提供了更专业、更精准的板块研判工具！
