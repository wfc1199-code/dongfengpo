# æœŸæƒå»¶è¿Ÿé—®é¢˜ - æ ¹æºåˆ†æ

## ğŸ¯ é—®é¢˜æ ¹æºå·²æ‰¾åˆ°ï¼

### ç—‡çŠ¶
å‰ç«¯æ˜¾ç¤ºï¼š**"æœŸæƒæ•°æ®æº: pipeline (æ— æ—¶é—´æˆ³ä¿¡æ¯)"**

### æ ¹æœ¬åŸå› 

**æ•°æ®ç»“æ„ä¸åŒ¹é…ï¼**

#### åç«¯è¿”å›çš„æ•°æ®ç»“æ„ï¼š
```json
{
  "status": "success",
  "data": [...],
  "freshness": {
    "data_time": "11:13",      â† æ—¶é—´åœ¨è¿™é‡Œ
    "current_time": "11:13",   â† æ—¶é—´åœ¨è¿™é‡Œ
    "delay_minutes": 0,
    "description": "å®æ—¶æ•°æ®"
  }
}
```

#### å‰ç«¯æŸ¥æ‰¾çš„ä½ç½®ï¼ˆé”™è¯¯ï¼‰ï¼š
```typescript
// ä¹‹å‰çš„ä»£ç 
const data_time = toStringSafe(raw.data_time);      // âŒ raw.data_time = undefined
const current_time = toStringSafe(raw.current_time); // âŒ raw.current_time = undefined
```

å‰ç«¯åœ¨**é¡¶å±‚**æ‰¾ `data_time`ï¼Œä½†å®é™…ä¸Šå®ƒåœ¨ **`freshness` å¯¹è±¡é‡Œ**ï¼

### ä¿®å¤æ–¹æ¡ˆ

```typescript
// ä¿®å¤åçš„ä»£ç 
const freshnessData = raw?.freshness || {};
const data_time = toStringSafe(freshnessData.data_time);      // âœ… æ­£ç¡®ä½ç½®
const current_time = toStringSafe(freshnessData.current_time); // âœ… æ­£ç¡®ä½ç½®
```

---

## ğŸ“Š å®Œæ•´æ•°æ®æµè¯Šæ–­

### 1. åç«¯çŠ¶æ€ âœ…
```
å½“å‰æ—¶é—´: 11:13:31
æœ€æ–°æ•°æ®: 11:13 - 347.8å…ƒ
å»¶è¿Ÿ: 0åˆ†é’Ÿ
freshness: {"delay_minutes": 0, "description": "å®æ—¶æ•°æ®"}
```

**ç»“è®ºï¼šåç«¯æ•°æ®å®Œå…¨æ­£å¸¸ï¼Œå®æ—¶æ— å»¶è¿Ÿï¼**

### 2. å‰ç«¯é—®é¢˜ âŒ

#### é—®é¢˜1ï¼šå­—æ®µæå–é”™è¯¯
```typescript
// é”™è¯¯ï¼šåœ¨é¡¶å±‚æ‰¾
const data_time = raw.data_time;  // undefined âŒ

// æ­£ç¡®ï¼šåœ¨freshnessä¸­æ‰¾
const data_time = raw.freshness.data_time;  // "11:13" âœ…
```

#### é—®é¢˜2ï¼šå¯¼è‡´çš„æ˜¾ç¤ºé—®é¢˜
```typescript
// TimeShareChartFixed.tsx Line 766
if (!data_time || !current_time) {
  // å› ä¸ºdata_timeæ˜¯undefinedï¼Œè¿›å…¥è¿™ä¸ªåˆ†æ”¯
  setDataDelayNotice(`æœŸæƒæ•°æ®æº: ${meta.source} (æ— æ—¶é—´æˆ³ä¿¡æ¯)`);
}
```

**ç»“æœ**ï¼šè™½ç„¶æ•°æ®æ˜¯å®æ—¶çš„ï¼Œä½†å› ä¸ºæå–ä¸åˆ°æ—¶é—´å­—æ®µï¼Œæ˜¾ç¤º"æ— æ—¶é—´æˆ³ä¿¡æ¯"

---

## ğŸ” ä¸ºä»€ä¹ˆä¹‹å‰çš„ä¿®æ”¹æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ

### ä¿®æ”¹å†å²å›é¡¾

1. **ç¬¬1æ¬¡ä¿®æ”¹**ï¼šåç«¯å®æ—¶APIæ•´åˆ âœ…
   - æˆåŠŸé™ä½å»¶è¿Ÿåˆ°0åˆ†é’Ÿ
   - åç«¯æ•°æ®æ­£å¸¸

2. **ç¬¬2æ¬¡ä¿®æ”¹**ï¼šå‰ç«¯æ•°æ®æºåˆ¤æ–­ âœ…
   - æ ¹æ®delay_minutesåŠ¨æ€æ ‡è®°
   - æ˜¾ç¤ºä»"legacy"å˜ä¸º"pipeline"

3. **ç¬¬3æ¬¡ä¿®æ”¹**ï¼šç¦ç”¨å‰ç«¯ç¼“å­˜ âœ…
   - åˆ é™¤500msç¼“å­˜
   - URLåŠ æ—¶é—´æˆ³

**ä½†æ˜¯**ï¼šæ‰€æœ‰ä¿®æ”¹éƒ½æ²¡æœ‰è§£å†³**å­—æ®µæå–é”™è¯¯**çš„æ ¹æœ¬é—®é¢˜ï¼

---

## ğŸ¯ æœ€ç»ˆä¿®å¤

### æ–‡ä»¶ï¼š`frontend/src/services/timeshare.service.ts`

#### Line 298-300ï¼ˆä¿®å¤å‰ï¼‰
```typescript
const data_time = toStringSafe(raw.data_time ?? raw.dataTime);
const current_time = toStringSafe(raw.current_time ?? raw.currentTime);
```

#### Line 298-301ï¼ˆä¿®å¤åï¼‰
```typescript
// ä¼˜å…ˆä»freshnessè·å–
const freshnessData = raw?.freshness || {};
const data_time = toStringSafe(freshnessData.data_time ?? raw.data_time ?? raw.dataTime);
const current_time = toStringSafe(freshnessData.current_time ?? raw.current_time ?? raw.currentTime);
```

---

## âœ… ä¿®å¤åçš„é¢„æœŸæ•ˆæœ

### Beforeï¼ˆä¿®å¤å‰ï¼‰
```
æ˜¾ç¤º: "æœŸæƒæ•°æ®æº: pipeline (æ— æ—¶é—´æˆ³ä¿¡æ¯)"
åŸå› : data_time = undefined
      current_time = undefined
ç»“æœ: æ— æ³•æ˜¾ç¤ºå»¶è¿Ÿä¿¡æ¯
```

### Afterï¼ˆä¿®å¤åï¼‰
```
æ˜¾ç¤º: æ— å»¶è¿Ÿè­¦å‘Šï¼ˆå› ä¸ºå»¶è¿Ÿ0åˆ†é’Ÿï¼‰
æˆ–
æ˜¾ç¤º: "æ•°æ®æ—¶é—´: 11:13, å½“å‰æ—¶é—´: 11:13"
åŸå› : data_time = "11:13"
      current_time = "11:13"
ç»“æœ: æ­£ç¡®æ˜¾ç¤ºå®æ—¶çŠ¶æ€
```

---

## ğŸ“ éªŒè¯æ­¥éª¤

### 1. ç­‰å¾…å‰ç«¯çƒ­é‡è½½ï¼ˆçº¦10ç§’ï¼‰

### 2. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨
```
Mac: Cmd + Shift + R
```

### 3. æŸ¥çœ‹æœŸæƒåˆ†æ—¶å›¾

**åº”è¯¥çœ‹åˆ°**ï¼š
- âœ… æ— å»¶è¿Ÿè­¦å‘Š
- âœ… æ•°æ®æ›´æ–°åˆ°å½“å‰æ—¶é—´
- âœ… ä¸å†æ˜¾ç¤º"(æ— æ—¶é—´æˆ³ä¿¡æ¯)"

### 4. éªŒè¯æ•°æ®æº

æ‰“å¼€å¼€å‘è€…å·¥å…· Consoleï¼Œè¿è¡Œï¼š
```javascript
// è¯·æ±‚æœŸæƒæ•°æ®
fetch('/api/options/MO2511-P-7400/minute')
  .then(r => r.json())
  .then(data => {
    console.log('freshness:', data.freshness);
    console.log('data_time:', data.freshness.data_time);
    console.log('current_time:', data.freshness.current_time);
  });
```

**é¢„æœŸè¾“å‡º**ï¼š
```
freshness: {delay_minutes: 0, description: "å®æ—¶æ•°æ®", data_time: "11:13", current_time: "11:13"}
data_time: "11:13"
current_time: "11:13"
```

---

## ğŸš€ æ€»ç»“

### é—®é¢˜æœ¬è´¨
**æ•°æ®ç»“æ„ä¸åŒ¹é…**ï¼šåç«¯æŠŠæ—¶é—´æ”¾åœ¨ `freshness` å¯¹è±¡é‡Œï¼Œå‰ç«¯åœ¨é¡¶å±‚æŸ¥æ‰¾ã€‚

### è§£å†³æ–¹æ¡ˆ
ä¿®æ”¹å‰ç«¯ä»£ç ï¼Œä»æ­£ç¡®çš„ä½ç½®ï¼ˆ`freshness` å¯¹è±¡ï¼‰æå–æ—¶é—´å­—æ®µã€‚

### å…³é”®æ•™è®­
1. **ä»”ç»†æ£€æŸ¥APIå“åº”ç»“æ„**ï¼šç”¨curlå®é™…æŸ¥çœ‹è¿”å›çš„JSON
2. **å¯¹ç…§å‰ç«¯è§£æé€»è¾‘**ï¼šç¡®ä¿å­—æ®µè·¯å¾„æ­£ç¡®
3. **å•æ­¥è°ƒè¯•**ï¼šå½“å¤šæ¬¡ä¿®æ”¹æ— æ•ˆæ—¶ï¼Œéœ€è¦å›åˆ°æ•°æ®æºå¤´

---

## ğŸ“ å¦‚æœè¿˜æœ‰é—®é¢˜

### æ£€æŸ¥ç‚¹1ï¼šå‰ç«¯æ˜¯å¦é‡æ–°ç¼–è¯‘
```bash
tail -f frontend.log | grep "Compiled"
```

### æ£€æŸ¥ç‚¹2ï¼šæµè§ˆå™¨æ˜¯å¦åˆ·æ–°
ç¡®ä¿æŒ‰äº† `Cmd + Shift + R` å¼ºåˆ¶åˆ·æ–°

### æ£€æŸ¥ç‚¹3ï¼šæ•°æ®æ˜¯å¦æ­£ç¡®æå–
åœ¨ Console ä¸­æŸ¥çœ‹ï¼š
```javascript
// æŸ¥çœ‹metaå¯¹è±¡
console.log(timeshareResult.meta);
```

åº”è¯¥çœ‹åˆ°ï¼š
```
{
  ...
  data_time: "11:13",        // âœ… æœ‰å€¼
  current_time: "11:13",     // âœ… æœ‰å€¼
  source: "pipeline"
}
```

---

**æ›´æ–°æ—¶é—´**ï¼š2025-10-20 11:15  
**ç‰ˆæœ¬**ï¼šv4.0 - ä¿®å¤å­—æ®µæå–é”™è¯¯ï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰
