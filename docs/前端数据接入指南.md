# 前端数据接入指南

本文概述前端如何接入重构后的分时数据处理中心服务，以及与遗留后端共存的策略。

## 环境变量

在根目录复制 `.env.example` 为 `.env` 后，可通过以下变量配置不同数据源：

- `REACT_APP_API_URL`：遗留后端（默认 `http://localhost:9000`）
- `REACT_APP_PIPELINE_API_URL`：数据流水线 REST（默认 `http://localhost:8000`）
- `REACT_APP_PIPELINE_WS_URL`：机会/风险 WebSocket（默认 `ws://localhost:8100/ws/opportunities`）
- `REACT_APP_REALTIME_WS_URL`：遗留实时行情 WebSocket（默认 `ws://localhost:9000/api/realtime/ws`）

调整 `.env` 后需重新运行 `npm start` 生效。

## 服务层说明

| 文件 | 说明 |
| --- | --- |
| `services/anomaly.service.ts` | 统一获取异动、热门板块、时间段数据，优先走 pipeline，失败回退 legacy |
| `services/pipeline.service.ts` | 访问 `signal-api`（8000）招机会列表等 |
| `services/backend.service.ts` | 仍依赖旧后端的功能（config、版本管理、扫描等）集中管理 |
| `hooks/useOpportunityFeed.ts` / `useRiskAlertFeed.ts` | WebSocket 订阅机会 / 风险推送 |

组件应尽量调用上述服务而不是直接写死 URL。

## 数据流概览

```
signal-api (8000) ──> OpportunityFeed / Anomaly服务
signal-streamer (8100) ──> useOpportunityFeed / useRiskAlertFeed
legacy backend (9000) ──> 未迁移功能（版本管理、自选配置等）
```

## 组件迁移现状

- ✅ 使用 pipeline 数据：`OpportunityFeed`、`RiskAlertPanel`、`AnomalyAlerts`、`HotSectors*`、`Sector*`、`SmartAlertsPanel` 等。
- 🔄 仍使用 legacy API：部分期权/行情接口、版本管理、智能预警扫描等（已通过 `backend.service.ts` 封装）。
- ⏳ 后续计划：逐步将 Market Scanner、版本管理等功能迁移至新服务。

## 开发建议

1. 优先引用 `services` 层封装，加新数据源时在对应服务中扩展。
2. 若需要实时推送，参考 `useOpportunityFeed`/`useRiskAlertFeed` 的实现。
3. 使用 `scripts/run_tests.sh` 快速验证 compileall 与主要单元测试，`npm run build` 将执行 ESLint。

