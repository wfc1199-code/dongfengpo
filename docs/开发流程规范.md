# ä¸œé£ç ´å¼€å‘æµç¨‹è§„èŒƒ

> **ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-01-18  
> **é€‚ç”¨èŒƒå›´**: ä¸œé£ç ´å…¨æ ˆå›¢é˜Ÿ  
> **ç›®æ ‡**: æå‡å¼€å‘æ•ˆç‡ï¼Œä¿è¯ä»£ç è´¨é‡ï¼Œå®ç°å¿«é€Ÿè¿­ä»£

---

## ğŸ“‹ ç›®å½•

1. [å¼€å‘æ–¹æ³•è®º](#1-å¼€å‘æ–¹æ³•è®º)
2. [Git å·¥ä½œæµ](#2-gitå·¥ä½œæµ)
3. [åˆ†æ”¯ç®¡ç†ç­–ç•¥](#3-åˆ†æ”¯ç®¡ç†ç­–ç•¥)
4. [ä»£ç æäº¤è§„èŒƒ](#4-ä»£ç æäº¤è§„èŒƒ)
5. [ä»£ç å®¡æŸ¥æµç¨‹](#5-ä»£ç å®¡æŸ¥æµç¨‹)
6. [æµ‹è¯•ç­–ç•¥](#6-æµ‹è¯•ç­–ç•¥)
7. [CI/CD æµç¨‹](#7-cicdæµç¨‹)
8. [å‘å¸ƒæµç¨‹](#8-å‘å¸ƒæµç¨‹)
9. [ç¼–ç è§„èŒƒ](#9-ç¼–ç è§„èŒƒ)
10. [æ–‡æ¡£è§„èŒƒ](#10-æ–‡æ¡£è§„èŒƒ)

---

## 1. å¼€å‘æ–¹æ³•è®º

### 1.1 é‡‡ç”¨ Scrum + Kanban æ··åˆæ¨¡å¼

**ä¸ºä»€ä¹ˆé€‰æ‹©æ··åˆæ¨¡å¼ï¼Ÿ**

- âœ… Scrum çš„è¿­ä»£è§„åˆ’é€‚åˆæ–°åŠŸèƒ½å¼€å‘
- âœ… Kanban çš„çµæ´»æ€§é€‚åˆ Bug ä¿®å¤å’Œç´§æ€¥éœ€æ±‚
- âœ… å°å›¢é˜Ÿæ›´éœ€è¦çµæ´»æ€§è€Œéä¸¥æ ¼æµç¨‹

### 1.2 å†²åˆºå‘¨æœŸ

**2 å‘¨ä¸€ä¸ª Sprint**

- Week 1-2: å¼€å‘ + æµ‹è¯•
- Week 2 æœ«: Sprint å›é¡¾ + ä¸‹ Sprint è§„åˆ’

**æ¯æ—¥ç«™ä¼š**ï¼ˆå¯é€‰ï¼‰

- æ—¶é—´: æ¯å¤©æ—©ä¸Š 10:00ï¼Œ15 åˆ†é’Ÿ
- å†…å®¹: æ˜¨å¤©åšäº†ä»€ä¹ˆã€ä»Šå¤©è®¡åˆ’åšä»€ä¹ˆã€é‡åˆ°ä»€ä¹ˆé˜»ç¢

### 1.3 éœ€æ±‚ç®¡ç†

ä½¿ç”¨ GitHub Issues + Projects çœ‹æ¿ï¼š

**çœ‹æ¿åˆ—**ï¼š

```
å¾…åŠ â†’ è®¾è®¡ä¸­ â†’ å¼€å‘ä¸­ â†’ ä»£ç å®¡æŸ¥ â†’ æµ‹è¯•ä¸­ â†’ å·²å®Œæˆ
```

**Issue æ ‡ç­¾ä½“ç³»**ï¼š

- `feature`: æ–°åŠŸèƒ½
- `enhancement`: åŠŸèƒ½å¢å¼º
- `bug`: Bug ä¿®å¤
- `hotfix`: ç´§æ€¥ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `P0/P1/P2/P3`: ä¼˜å…ˆçº§

---

## 2. Git å·¥ä½œæµ

### 2.1 é‡‡ç”¨ GitHub Flowï¼ˆç®€åŒ–ç‰ˆï¼‰

**ä¸ºä»€ä¹ˆä¸ç”¨ Git Flowï¼Ÿ**

- Git Flow è¿‡äºå¤æ‚ï¼Œé€‚åˆå¤§å‹å›¢é˜Ÿ
- ä¸œé£ç ´æ˜¯å°å›¢é˜Ÿï¼Œéœ€è¦å¿«é€Ÿè¿­ä»£
- GitHub Flow æ›´ç®€å•ï¼Œæ›´é€‚åˆæŒç»­éƒ¨ç½²

### 2.2 æ ¸å¿ƒåŸåˆ™

1. **main åˆ†æ”¯æ°¸è¿œæ˜¯å¯éƒ¨ç½²çš„**
2. **ä» main åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**
3. **å®šæœŸæäº¤ï¼Œæ¨é€åˆ°è¿œç¨‹**
4. **é€šè¿‡ Pull Request åˆå¹¶**
5. **ä»£ç å®¡æŸ¥åæ‰èƒ½åˆå¹¶**
6. **åˆå¹¶åç«‹å³éƒ¨ç½²**

### 2.3 å·¥ä½œæµç¨‹å›¾

```mermaid
graph LR
    A[main] -->|åˆ›å»ºåˆ†æ”¯| B[feature/xxx]
    B -->|å¼€å‘| C[æäº¤ä»£ç ]
    C -->|æ¨é€| D[åˆ›å»ºPR]
    D -->|ä»£ç å®¡æŸ¥| E{å®¡æŸ¥é€šè¿‡?}
    E -->|å¦| C
    E -->|æ˜¯| F[åˆå¹¶åˆ°main]
    F -->|è‡ªåŠ¨| G[CI/CDéƒ¨ç½²]
    G --> H[ç”Ÿäº§ç¯å¢ƒ]
```

---

## 3. åˆ†æ”¯ç®¡ç†ç­–ç•¥

### 3.1 åˆ†æ”¯å‘½åè§„èŒƒ

```
<type>/<ticket-id>-<brief-description>

ç¤ºä¾‹:
feature/DFP-101-backtest-engine
bugfix/DFP-202-radar-crash
hotfix/DFP-303-data-missing
refactor/DFP-404-clean-legacy-code
```

**ç±»å‹å‰ç¼€**ï¼š

- `feature/`: æ–°åŠŸèƒ½
- `bugfix/`: Bug ä¿®å¤
- `hotfix/`: ç´§æ€¥ä¿®å¤ï¼ˆå¯ç›´æ¥ä» main æ‹‰å–ï¼‰
- `refactor/`: ä»£ç é‡æ„
- `test/`: æµ‹è¯•ç›¸å…³
- `docs/`: æ–‡æ¡£æ›´æ–°
- `chore/`: æ„å»ºã€é…ç½®ç­‰æ‚é¡¹

### 3.2 åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸ

1. **åˆ›å»ºåˆ†æ”¯**

   ```bash
   git checkout main
   git pull origin main
   git checkout -b feature/DFP-101-backtest-engine
   ```

2. **å¼€å‘è¿‡ç¨‹**

   ```bash
   # ç»å¸¸æäº¤ï¼Œä¿æŒå°ç²’åº¦
   git add .
   git commit -m "feat: add backtest executor"
   git push origin feature/DFP-101-backtest-engine
   ```

3. **ä¿æŒä¸ main åŒæ­¥**

   ```bash
   git checkout main
   git pull origin main
   git checkout feature/DFP-101-backtest-engine
   git rebase main  # æˆ–ä½¿ç”¨ merge
   ```

4. **åˆå¹¶ååˆ é™¤**
   ```bash
   # PRåˆå¹¶å
   git checkout main
   git pull origin main
   git branch -d feature/DFP-101-backtest-engine
   git push origin --delete feature/DFP-101-backtest-engine
   ```

### 3.3 åˆ†æ”¯ä¿æŠ¤è§„åˆ™

**main åˆ†æ”¯ä¿æŠ¤**ï¼š

- âœ… ç¦æ­¢ç›´æ¥æ¨é€
- âœ… å¿…é¡»é€šè¿‡ PR åˆå¹¶
- âœ… è‡³å°‘ 1 äººå®¡æŸ¥é€šè¿‡
- âœ… CI æ£€æŸ¥å¿…é¡»é€šè¿‡
- âœ… åˆ†æ”¯å¿…é¡»æ˜¯æœ€æ–°çš„ï¼ˆè¦æ±‚ rebaseï¼‰

---

## 4. ä»£ç æäº¤è§„èŒƒ

### 4.1 Conventional Commits è§„èŒƒ

é‡‡ç”¨ä¸šç•Œæ ‡å‡†çš„[Conventional Commits](https://www.conventionalcommits.org/)ï¼š

**æ ¼å¼**ï¼š

```
<type>(<scope>): <subject>

<body>

<footer>
```

**ç¤ºä¾‹**ï¼š

```
feat(backtest): add genetic algorithm optimizer

- Implement population initialization
- Add fitness evaluation
- Implement crossover and mutation

Closes #101
```

### 4.2 Type ç±»å‹

| Type       | è¯´æ˜                                | ç¤ºä¾‹                                        |
| ---------- | ----------------------------------- | ------------------------------------------- |
| `feat`     | æ–°åŠŸèƒ½                              | `feat(radar): add ignition strategy`        |
| `fix`      | Bug ä¿®å¤                            | `fix(api): resolve data missing issue`      |
| `docs`     | æ–‡æ¡£æ›´æ–°                            | `docs(readme): update installation guide`   |
| `style`    | ä»£ç æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œï¼‰          | `style: format code with black`             |
| `refactor` | é‡æ„ï¼ˆæ—¢ä¸æ˜¯æ–°åŠŸèƒ½ä¹Ÿä¸æ˜¯ bug ä¿®å¤ï¼‰ | `refactor(strategy): extract base class`    |
| `perf`     | æ€§èƒ½ä¼˜åŒ–                            | `perf(backtest): optimize numpy operations` |
| `test`     | æ·»åŠ æµ‹è¯•                            | `test(optimizer): add unit tests`           |
| `chore`    | æ„å»ºã€é…ç½®ç­‰                        | `chore(deps): upgrade fastapi to 0.109.0`   |
| `revert`   | å›æ»š                                | `revert: revert commit abc123`              |

### 4.3 Scope èŒƒå›´

**åç«¯**ï¼š

- `backtest`: å›æµ‹å¼•æ“
- `optimizer`: å‚æ•°ä¼˜åŒ–
- `radar`: ç›¯ç›˜é›·è¾¾
- `signal`: ä¿¡å·æœåŠ¡
- `gateway`: API ç½‘å…³
- `strategy`: ç­–ç•¥æ¨¡å—

**å‰ç«¯**ï¼š

- `ui`: UI ç»„ä»¶
- `page`: é¡µé¢
- `chart`: å›¾è¡¨
- `api`: API è°ƒç”¨

**é€šç”¨**ï¼š

- `config`: é…ç½®
- `deps`: ä¾èµ–
- `ci`: CI/CD

### 4.4 æäº¤æœ€ä½³å®è·µ

âœ… **DO**ï¼š

- æ¯ä¸ªæäº¤åªåšä¸€ä»¶äº‹
- æäº¤ä¿¡æ¯æ¸…æ™°æè¿°æ”¹åŠ¨
- ç»å¸¸æäº¤ï¼Œä¿æŒå°ç²’åº¦
- æäº¤å‰è¿è¡Œæµ‹è¯•å’Œ linter

âŒ **DON'T**ï¼š

- ä¸€ä¸ªæäº¤åŒ…å«å¤šä¸ªä¸ç›¸å…³çš„æ”¹åŠ¨
- æäº¤ä¿¡æ¯æ¨¡ç³Šï¼ˆå¦‚"fix bug"ï¼‰
- æäº¤æœªæµ‹è¯•çš„ä»£ç 
- æäº¤åŒ…å« TODO çš„ä»£ç åˆ° main

---

## 5. ä»£ç å®¡æŸ¥æµç¨‹

### 5.1 Pull Request æµç¨‹

```mermaid
graph TB
    A[å¼€å‘å®Œæˆ] --> B[è‡ªæ£€Checklist]
    B --> C[åˆ›å»ºPR]
    C --> D[è‡ªåŠ¨CIæ£€æŸ¥]
    D -->|å¤±è´¥| E[ä¿®å¤é—®é¢˜]
    E --> D
    D -->|é€šè¿‡| F[è¯·æ±‚å®¡æŸ¥]
    F --> G[ä»£ç å®¡æŸ¥]
    G -->|éœ€è¦ä¿®æ”¹| H[ä¿®æ”¹ä»£ç ]
    H --> D
    G -->|é€šè¿‡| I[åˆå¹¶åˆ°main]
    I --> J[åˆ é™¤åˆ†æ”¯]
    J --> K[è‡ªåŠ¨éƒ¨ç½²]
```

### 5.2 PR åˆ›å»ºè§„èŒƒ

**PR æ ‡é¢˜**ï¼š

```
[<type>] <ç®€çŸ­æè¿°>

ç¤ºä¾‹:
[Feature] Add backtest engine with genetic algorithm
[Bugfix] Fix radar crash on empty data
[Hotfix] Resolve data API timeout
```

**PR æè¿°æ¨¡æ¿**ï¼š

```markdown
## ğŸ“ æ”¹åŠ¨è¯´æ˜

ç®€è¦è¯´æ˜æœ¬æ¬¡ PR çš„ç›®çš„å’Œæ”¹åŠ¨å†…å®¹

## ğŸ¯ å…³è” Issue

Closes #101

## ğŸ“‹ æ”¹åŠ¨æ¸…å•

- [ ] åç«¯
  - [x] æ·»åŠ å›æµ‹å¼•æ“
  - [x] å®ç°é—ä¼ ç®—æ³•
- [ ] å‰ç«¯
  - [x] å›æµ‹é…ç½®é¡µé¢
  - [x] ç»“æœå±•ç¤ºé¡µé¢
- [ ] æµ‹è¯•
  - [x] å•å…ƒæµ‹è¯•
  - [ ] é›†æˆæµ‹è¯•

## ğŸ§ª æµ‹è¯•è¯´æ˜

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: 85%
- æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤:
  1. å¯åŠ¨å›æµ‹æœåŠ¡
  2. è®¿é—® /backtest é¡µé¢
  3. é…ç½®å‚æ•°å¹¶è¿è¡Œ

## ğŸ“¸ æˆªå›¾/å½•å±

ï¼ˆå¦‚æœæœ‰ UI æ”¹åŠ¨ï¼Œé™„ä¸Šæˆªå›¾ï¼‰

## âš ï¸ ç ´åæ€§å˜æ›´

æ— 

## ğŸ“š æ–‡æ¡£

- [x] æ›´æ–°äº† API æ–‡æ¡£
- [x] æ›´æ–°äº† README

## âœ… è‡ªæ£€ Checklist

- [x] ä»£ç ç¬¦åˆç¼–ç è§„èŒƒ
- [x] é€šè¿‡äº†æ‰€æœ‰æµ‹è¯•
- [x] æ·»åŠ äº†å¿…è¦çš„æµ‹è¯•
- [x] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [x] æ²¡æœ‰é—ç•™ TODO
```

### 5.3 ä»£ç å®¡æŸ¥ Checklist

**åŠŸèƒ½æ€§**ï¼š

- [ ] ä»£ç å®ç°äº†éœ€æ±‚çš„åŠŸèƒ½
- [ ] è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„

**ä»£ç è´¨é‡**ï¼š

- [ ] å‘½åæ¸…æ™°ï¼ˆå˜é‡ã€å‡½æ•°ã€ç±»ï¼‰
- [ ] é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£
- [ ] æ— é‡å¤ä»£ç ï¼ˆDRY åŸåˆ™ï¼‰
- [ ] å‡½æ•°å•ä¸€èŒè´£ï¼ˆSRP åŸåˆ™ï¼‰
- [ ] æ— è¿‡é•¿çš„å‡½æ•°ï¼ˆå»ºè®®<50 è¡Œï¼‰

**æ€§èƒ½**ï¼š

- [ ] æ— æ˜æ˜¾æ€§èƒ½é—®é¢˜
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] é¿å… N+1 æŸ¥è¯¢

**å®‰å…¨**ï¼š

- [ ] è¾“å…¥éªŒè¯
- [ ] SQL æ³¨å…¥é˜²æŠ¤
- [ ] XSS é˜²æŠ¤
- [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†

**æµ‹è¯•**ï¼š

- [ ] æ ¸å¿ƒé€»è¾‘æœ‰å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡åˆç†ï¼ˆ>80%ï¼‰
- [ ] æµ‹è¯•ç”¨ä¾‹å……åˆ†

**æ–‡æ¡£**ï¼š

- [ ] å¤æ‚é€»è¾‘æœ‰æ³¨é‡Š
- [ ] API æœ‰æ–‡æ¡£
- [ ] README æ›´æ–°

### 5.4 å®¡æŸ¥åé¦ˆè§„èŒƒ

**ä½¿ç”¨æ ‡ç­¾**ï¼š

- ğŸ”´ **[å¿…é¡»ä¿®æ”¹]**: ä¸¥é‡é—®é¢˜ï¼Œå¿…é¡»ä¿®å¤
- ğŸŸ¡ **[å»ºè®®]**: æ”¹è¿›å»ºè®®ï¼Œå¯è®¨è®º
- ğŸŸ¢ **[èµ]**: å¥½çš„å®ç°ï¼Œå€¼å¾—å­¦ä¹ 
- ğŸ”µ **[é—®é¢˜]**: ä¸ç†è§£çš„åœ°æ–¹ï¼Œéœ€è¦è§£é‡Š

**ç¤ºä¾‹**ï¼š

```
ğŸ”´ [å¿…é¡»ä¿®æ”¹] è¿™é‡Œå­˜åœ¨SQLæ³¨å…¥é£é™©ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢

ğŸŸ¡ [å»ºè®®] è¿™ä¸ªå‡½æ•°æœ‰ç‚¹é•¿ï¼Œå»ºè®®æ‹†åˆ†æˆå‡ ä¸ªå°å‡½æ•°

ğŸŸ¢ [èµ] è¿™ä¸ªé”™è¯¯å¤„ç†å†™å¾—å¾ˆå¥½ï¼

ğŸ”µ [é—®é¢˜] ä¸ºä»€ä¹ˆè¿™é‡Œè¦ç”¨é€’å½’è€Œä¸æ˜¯å¾ªç¯ï¼Ÿ
```

---

## 6. æµ‹è¯•ç­–ç•¥

### 6.1 æµ‹è¯•é‡‘å­—å¡”

```
        å•å…ƒæµ‹è¯• (70%)
       /              \
      /   é›†æˆæµ‹è¯•(20%) \
     /                   \
    /   ç«¯åˆ°ç«¯æµ‹è¯• (10%)   \
   -------------------------
```

### 6.2 å•å…ƒæµ‹è¯•

**åŸåˆ™**ï¼š

- æ¯ä¸ªå‡½æ•°/æ–¹æ³•éƒ½åº”æœ‰å•å…ƒæµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼š>80%
- ä½¿ç”¨ pytest æ¡†æ¶

**ç¤ºä¾‹**ï¼š

```python
# tests/test_optimizer.py
import pytest
from backtest.core.optimizer import GeneticOptimizer

def test_genetic_optimizer_initialization():
    """æµ‹è¯•é—ä¼ ç®—æ³•ä¼˜åŒ–å™¨åˆå§‹åŒ–"""
    optimizer = GeneticOptimizer(
        strategy_class=MockStrategy,
        param_space={'threshold': {'range': [1, 10]}},
        population_size=50
    )
    assert optimizer.population_size == 50
    assert len(optimizer.population) == 50

def test_genetic_optimizer_evolution():
    """æµ‹è¯•é—ä¼ ç®—æ³•è¿›åŒ–è¿‡ç¨‹"""
    optimizer = GeneticOptimizer(...)
    result = optimizer.optimize()

    assert 'best_params' in result
    assert 'best_score' in result
    assert result['best_score'] > 0
```

**å‘½åè§„èŒƒ**ï¼š

```python
def test_<åŠŸèƒ½æè¿°>_<åœºæ™¯>_<é¢„æœŸç»“æœ>():
    # ä¾‹å¦‚:
    # test_backtest_with_empty_data_raises_error
    # test_optimizer_finds_best_params_successfully
    pass
```

### 6.3 é›†æˆæµ‹è¯•

**æµ‹è¯•æœåŠ¡ä¹‹é—´çš„äº¤äº’**ï¼š

```python
# tests/integration/test_backtest_flow.py
@pytest.mark.integration
async def test_complete_backtest_flow():
    """æµ‹è¯•å®Œæ•´å›æµ‹æµç¨‹ï¼šé…ç½®â†’æ‰§è¡Œâ†’ç»“æœ"""
    # 1. åˆ›å»ºå›æµ‹ä»»åŠ¡
    response = await client.post('/api/backtest/run', json={
        'strategy': 'ignition',
        'params': {...}
    })
    task_id = response.json()['task_id']

    # 2. ç­‰å¾…æ‰§è¡Œå®Œæˆ
    await wait_for_completion(task_id)

    # 3. è·å–ç»“æœ
    result = await client.get(f'/api/backtest/results/{task_id}')
    assert result.status_code == 200
    assert result.json()['metrics']['total_return'] > 0
```

### 6.4 ç«¯åˆ°ç«¯æµ‹è¯•

ä½¿ç”¨ Playwright è¿›è¡Œå‰ç«¯ E2E æµ‹è¯•ï¼š

```python
# tests/e2e/test_backtest_page.py
def test_backtest_page_workflow(page):
    """æµ‹è¯•å›æµ‹é¡µé¢å®Œæ•´æµç¨‹"""
    # è®¿é—®é¡µé¢
    page.goto('http://localhost:3000/backtest')

    # é€‰æ‹©ç­–ç•¥
    page.select_option('#strategy', 'ignition')

    # é…ç½®å‚æ•°
    page.fill('#start-date', '2023-01-01')
    page.fill('#end-date', '2024-12-31')

    # è¿è¡Œå›æµ‹
    page.click('button:text("å¼€å§‹å›æµ‹")')

    # ç­‰å¾…ç»“æœ
    page.wait_for_selector('.backtest-result')

    # éªŒè¯ç»“æœ
    assert page.is_visible('.performance-chart')
```

### 6.5 æµ‹è¯•è¿è¡Œ

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/unit

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration -m integration

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=backtest_engine --cov-report=html
```

---

## 7. CI/CD æµç¨‹

### 7.1 CI æµç¨‹ï¼ˆGitHub Actionsï¼‰

**`.github/workflows/ci.yml`**:

```yaml
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test-backend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: Lint with ruff
        run: ruff check .

      - name: Type check with mypy
        run: mypy services/

      - name: Run tests
        run: pytest --cov --cov-report=xml

      - name: Upload coverage
        uses: codecov/codecov-action@v3

  test-frontend:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependencies
        run: cd frontend && npm ci

      - name: Lint
        run: cd frontend && npm run lint

      - name: Type check
        run: cd frontend && npm run type-check

      - name: Run tests
        run: cd frontend && npm test

      - name: Build
        run: cd frontend && npm run build
```

### 7.2 CD æµç¨‹

**è‡ªåŠ¨éƒ¨ç½²æµç¨‹**ï¼š

```yaml
name: CD

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    steps:
      - uses: actions/checkout@v3

      - name: Deploy to production
        run: |
          # éƒ¨ç½²è„šæœ¬
          ./scripts/deploy.sh
```

---

## 8. å‘å¸ƒæµç¨‹

### 8.1 è¯­ä¹‰åŒ–ç‰ˆæœ¬

é‡‡ç”¨[SemVer](https://semver.org/)è§„èŒƒï¼š`MAJOR.MINOR.PATCH`

- **MAJOR**: ä¸å…¼å®¹çš„ API å˜æ›´
- **MINOR**: å‘åå…¼å®¹çš„åŠŸèƒ½æ–°å¢
- **PATCH**: å‘åå…¼å®¹çš„ Bug ä¿®å¤

**ç¤ºä¾‹**ï¼š

```
v1.0.0 â†’ åˆå§‹ç‰ˆæœ¬
v1.1.0 â†’ æ·»åŠ å›æµ‹åŠŸèƒ½
v1.1.1 â†’ ä¿®å¤å›æµ‹Bug
v2.0.0 â†’ é‡æ„APIï¼ˆç ´åæ€§å˜æ›´ï¼‰
```

### 8.2 å‘å¸ƒ Checklist

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥å®Œæˆ
- [ ] æ›´æ–° CHANGELOG.md
- [ ] æ›´æ–°ç‰ˆæœ¬å·
- [ ] åˆ›å»º Git tag
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- [ ] å‘å¸ƒè¯´æ˜

### 8.3 CHANGELOG æ ¼å¼

```markdown
# Changelog

## [1.1.0] - 2025-01-18

### Added

- å›æµ‹å¼•æ“åŠŸèƒ½
- é—ä¼ ç®—æ³•å‚æ•°ä¼˜åŒ–
- Walk-Forward åˆ†æ

### Changed

- ä¼˜åŒ–é›·è¾¾æ‰«ææ€§èƒ½

### Fixed

- ä¿®å¤æ•°æ®ç¼ºå¤±é—®é¢˜

### Deprecated

- æ—§ç‰ˆ API å°†åœ¨ v2.0 ç§»é™¤
```

---

## 9. ç¼–ç è§„èŒƒ

### 9.1 Pythonï¼ˆPEP 8 + Blackï¼‰

**ä½¿ç”¨å·¥å…·**ï¼š

- **Black**: ä»£ç æ ¼å¼åŒ–
- **Ruff**: å¿«é€Ÿ linter
- **Mypy**: ç±»å‹æ£€æŸ¥

**é…ç½®æ–‡ä»¶ `pyproject.toml`**ï¼š

```toml
[tool.black]
line-length = 100
target-version = ['py312']

[tool.ruff]
line-length = 100
select = ["E", "F", "I", "N", "W"]

[tool.mypy]
python_version = "3.12"
strict = true
```

**å‘½åè§„èŒƒ**ï¼š

```python
# æ¨¡å—/åŒ…: å°å†™+ä¸‹åˆ’çº¿
backtest_engine/

# ç±»: å¤§é©¼å³°
class GeneticOptimizer:

# å‡½æ•°/æ–¹æ³•: å°å†™+ä¸‹åˆ’çº¿
def calculate_fitness():

# å¸¸é‡: å¤§å†™+ä¸‹åˆ’çº¿
MAX_POPULATION_SIZE = 100

# ç§æœ‰: å‰ç¼€å•ä¸‹åˆ’çº¿
def _internal_method():
```

### 9.2 TypeScript/React

**ä½¿ç”¨å·¥å…·**ï¼š

- **ESLint**: ä»£ç æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **TypeScript**: ç±»å‹æ£€æŸ¥

**å‘½åè§„èŒƒ**ï¼š

```typescript
// ç»„ä»¶: å¤§é©¼å³°
const BacktestPage: React.FC = () => {};

// å‡½æ•°: å°é©¼å³°
function calculatePerformance() {}

// æ¥å£/ç±»å‹: å¤§é©¼å³°ï¼ŒåŠ Iå‰ç¼€
interface IBacktestResult {}

// å¸¸é‡: å¤§å†™+ä¸‹åˆ’çº¿
const API_BASE_URL = "...";

// æ–‡ä»¶å:
// ç»„ä»¶: BacktestPage.tsx
// å·¥å…·: utils.ts
// ç±»å‹: types.ts
```

---

## 10. æ–‡æ¡£è§„èŒƒ

### 10.1 ä»£ç æ³¨é‡Š

**Python æ–‡æ¡£å­—ç¬¦ä¸²**ï¼š

```python
def calculate_sharpe_ratio(returns: pd.Series, risk_free_rate: float = 0.03) -> float:
    """
    è®¡ç®—å¤æ™®æ¯”ç‡

    Args:
        returns: æ”¶ç›Šç‡åºåˆ—
        risk_free_rate: æ— é£é™©åˆ©ç‡ï¼Œé»˜è®¤3%

    Returns:
        å¤æ™®æ¯”ç‡å€¼

    Raises:
        ValueError: å¦‚æœæ”¶ç›Šç‡åºåˆ—ä¸ºç©º

    Examples:
        >>> returns = pd.Series([0.01, 0.02, -0.01])
        >>> calculate_sharpe_ratio(returns)
        1.23
    """
    if len(returns) == 0:
        raise ValueError("æ”¶ç›Šç‡åºåˆ—ä¸èƒ½ä¸ºç©º")

    excess_returns = returns - risk_free_rate / 252
    return excess_returns.mean() / excess_returns.std() * np.sqrt(252)
```

### 10.2 README ç»“æ„

```markdown
# é¡¹ç›®åç§°

ç®€çŸ­æè¿°

## åŠŸèƒ½ç‰¹æ€§

- ç‰¹æ€§ 1
- ç‰¹æ€§ 2

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

### å®‰è£…

### è¿è¡Œ

## æ¶æ„è®¾è®¡

## API æ–‡æ¡£

## å¼€å‘æŒ‡å—

## æµ‹è¯•

## éƒ¨ç½²

## è´¡çŒ®æŒ‡å—

## è®¸å¯è¯
```

---

## ğŸ“Š æµç¨‹æ‰§è¡Œæ£€æŸ¥æ¸…å•

### å¼€å‘å‰

- [ ] åœ¨ GitHub Issues åˆ›å»º Issue
- [ ] Issue åˆ†é…åˆ°å½“å‰ Sprint
- [ ] ä» main åˆ›å»ºåŠŸèƒ½åˆ†æ”¯

### å¼€å‘ä¸­

- [ ] éµå¾ªç¼–ç è§„èŒƒ
- [ ] ç»å¸¸æäº¤ï¼Œä¿æŒå°ç²’åº¦
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] æœ¬åœ°è¿è¡Œæµ‹è¯•å’Œ linter

### æäº¤ PR å‰

- [ ] ä»£ç æ ¼å¼åŒ–ï¼ˆBlack/Prettierï¼‰
- [ ] Linter æ£€æŸ¥é€šè¿‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–ç‡>80%
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] å¡«å†™å®Œæ•´çš„ PR æè¿°

### ä»£ç å®¡æŸ¥

- [ ] è‡³å°‘ 1 äººå®¡æŸ¥é€šè¿‡
- [ ] CI æ£€æŸ¥å…¨éƒ¨é€šè¿‡
- [ ] è§£å†³æ‰€æœ‰å®¡æŸ¥æ„è§

### åˆå¹¶å

- [ ] åˆ é™¤åŠŸèƒ½åˆ†æ”¯
- [ ] å…³é—­ç›¸å…³ Issue
- [ ] éªŒè¯ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

**æ–‡æ¡£ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-01-18  
**ä¸‹æ¬¡å®¡æ ¸**: æ¯å­£åº¦æˆ–æœ‰é‡å¤§å˜æ›´æ—¶
