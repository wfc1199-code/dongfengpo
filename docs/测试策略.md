# 测试策略

重构后的分时数据处理中心包含多个独立服务，每个服务都附带单元测试或编译检查。以下列出建议的测试阶梯，便于在开发或 CI 中逐步验证。

## 1. 基础语法检查

所有 Python 服务可使用 `compileall` 进行快速语法校验：

```bash
python -m compileall services/collector-gateway
python -m compileall services/data-cleaner
python -m compileall services/data-lake-writer
python -m compileall services/feature-pipeline
python -m compileall services/strategy-engine
python -m compileall services/opportunity-aggregator
python -m compileall services/risk-guard
python -m compileall services/signal-api
python -m compileall services/signal-streamer
python -m compileall services/backtest-service
```

## 2. 单元测试

部分服务包含 pytest 用例，可在虚拟环境中执行：

```bash
pytest services/collector-gateway/tests
pytest services/data-cleaner/tests
pytest services/data-lake-writer/tests
pytest services/feature-pipeline/tests
pytest services/strategy-engine/tests
pytest services/opportunity-aggregator/tests
pytest services/signal-api/tests
pytest services/backtest-service/tests
```

> 若需一次性运行，可在项目根目录执行 `pytest services`。如未安装某些服务依赖，可根据 `.env.example` 或 README 提示选择性安装。

也可以使用脚本一次完成编译检查与主要 pytest 套件：

```bash
chmod +x scripts/run_tests.sh
./scripts/run_tests.sh
```

## 3. 集成验证思路

1. 启动核心服务流水线（参考 `scripts/start_pipeline.sh` 或启动指南）。
2. 通过 `curl`、WebSocket 或回测接口分别验证 REST/WS 端点。
3. 可在 `data-lake` 目录放置测试数据（Parquet），对 `backtest-service` 进行更真实的回测验证。

## 4. CI 建议

- 在 CI 中可分阶段执行：
  1. 安装通用依赖 `pip install -r services/<service>/requirements.txt`。
  2. 运行 `python -m compileall services`。
  3. 运行核心 pytest 集合（可分批以减小单次开销）。
- 对于需 Redis 的集成测试，可在 CI 中启动 Redis 容器并使用 `.env.example` 作为基础配置。
