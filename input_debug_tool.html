<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾“å…¥æ¡†è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #e5e5e5;
        }
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
        }
        .debug-section {
            border: 1px solid #444;
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            background: #1e1e1e;
        }
        .debug-title {
            font-weight: bold;
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .btn {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #357abd;
        }
        .output {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .success { color: #4caf50; }
        .warning { color: #ff9800; }
        .error { color: #f44336; }
        .info { color: #2196f3; }

        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #444;
            border-radius: 4px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ è¾“å…¥æ¡†è°ƒè¯•å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©è¯Šæ–­å’Œè§£å†³Reactåº”ç”¨ä¸­çš„è¾“å…¥æ¡†é—®é¢˜</p>

        <div class="debug-section">
            <div class="debug-title">1. Reactåº”ç”¨çŠ¶æ€æ£€æŸ¥</div>
            <button class="btn" onclick="checkReactApp()">æ£€æŸ¥Reactåº”ç”¨</button>
            <button class="btn" onclick="checkBackendAPI()">æ£€æŸ¥åç«¯API</button>
            <button class="btn" onclick="openReactApp()">æ‰“å¼€Reactåº”ç”¨</button>
            <div id="app-status" class="output">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</div>
        </div>

        <div class="debug-section">
            <div class="debug-title">2. å®æ—¶è¾“å…¥æ¡†ç›‘æ§</div>
            <button class="btn" onclick="startInputMonitoring()">å¼€å§‹ç›‘æ§</button>
            <button class="btn" onclick="stopInputMonitoring()">åœæ­¢ç›‘æ§</button>
            <button class="btn" onclick="injectDebugScript()">æ³¨å…¥è°ƒè¯•è„šæœ¬</button>
            <div id="monitoring-output" class="output">ç›‘æ§è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>

        <div class="debug-section">
            <div class="debug-title">3. æµè§ˆå™¨æ§åˆ¶å°å‘½ä»¤</div>
            <p>æ‰“å¼€Reactåº”ç”¨åï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
            <div class="output">
<span class="info">// æ£€æŸ¥è¾“å…¥æ¡†çŠ¶æ€</span>
<span class="success">window.debugInput = () => {
  const inputs = document.querySelectorAll('.search-input');
  inputs.forEach((input, i) => {
    console.log(\`è¾“å…¥æ¡† \${i}:\`, {
      disabled: input.disabled,
      readOnly: input.readOnly,
      style: {
        pointerEvents: getComputedStyle(input).pointerEvents,
        cursor: getComputedStyle(input).cursor,
        opacity: getComputedStyle(input).opacity,
        backgroundColor: getComputedStyle(input).backgroundColor,
        color: getComputedStyle(input).color
      },
      attributes: Array.from(input.attributes).map(a => \`\${a.name}=\${a.value}\`)
    });
  });
};</span>

<span class="info">// å¼ºåˆ¶ä¿®å¤è¾“å…¥æ¡†</span>
<span class="warning">window.forceFixInput = () => {
  const inputs = document.querySelectorAll('.search-input');
  inputs.forEach(input => {
    input.removeAttribute('disabled');
    input.removeAttribute('readonly');
    input.style.pointerEvents = 'auto';
    input.style.cursor = 'text';
    input.style.opacity = '1';
    input.style.backgroundColor = '#2a2a2a';
    input.style.color = '#fff';
    input.focus();
    console.log('å·²ä¿®å¤è¾“å…¥æ¡†:', input);
  });
};</span>

<span class="info">// æŒç»­ç›‘æ§è¾“å…¥æ¡†</span>
<span class="error">window.monitorInput = () => {
  if (window.inputMonitor) clearInterval(window.inputMonitor);
  window.inputMonitor = setInterval(() => {
    const inputs = document.querySelectorAll('.search-input');
    inputs.forEach(input => {
      const style = getComputedStyle(input);
      if (style.pointerEvents === 'none' || input.disabled) {
        console.warn('âš ï¸ è¾“å…¥æ¡†è¢«ç¦ç”¨ï¼Œæ­£åœ¨ä¿®å¤...');
        window.forceFixInput();
      }
    });
  }, 1000);
  console.log('âœ… å¼€å§‹ç›‘æ§è¾“å…¥æ¡†');
};</span>
            </div>
            <button class="btn" onclick="copyCommands()">å¤åˆ¶å‘½ä»¤åˆ°å‰ªè´´æ¿</button>
        </div>

        <div class="debug-section">
            <div class="debug-title">4. å¿«é€Ÿæµ‹è¯•</div>
            <p>åœ¨Reactåº”ç”¨ä¸­æµ‹è¯•è¾“å…¥æ¡†ï¼š</p>
            <ol>
                <li>ç‚¹å‡»å³ä¾§çš„"â•"æŒ‰é’®æ‰“å¼€æ·»åŠ è‡ªé€‰è‚¡å¯¹è¯æ¡†</li>
                <li>æ£€æŸ¥è¾“å…¥æ¡†æ˜¯å¦æ˜¾ç¤ºä¸ºæ·±ç°è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—</li>
                <li>å°è¯•ç‚¹å‡»è¾“å…¥æ¡†å¹¶è¾“å…¥æ–‡å­—</li>
                <li>å¦‚æœæ— æ³•è¾“å…¥ï¼Œåœ¨æ§åˆ¶å°è¿è¡Œ <code>debugInput()</code> æ£€æŸ¥çŠ¶æ€</li>
                <li>ç„¶åè¿è¡Œ <code>forceFixInput()</code> å¼ºåˆ¶ä¿®å¤</li>
            </ol>
        </div>

        <div class="debug-section">
            <div class="debug-title">5. æ„å»ºå’Œé‡æ–°åŠ è½½</div>
            <button class="btn" onclick="rebuildReact()">é‡æ–°æ„å»ºReactåº”ç”¨</button>
            <button class="btn" onclick="clearCache()">æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</button>
            <button class="btn" onclick="hardRefresh()">ç¡¬åˆ·æ–°é¡µé¢</button>
            <div id="build-output" class="output">æ„å»ºè¾“å‡º...</div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;

        async function checkReactApp() {
            const output = document.getElementById('app-status');
            output.innerHTML = '<span class="info">ğŸ” æ£€æŸ¥Reactåº”ç”¨çŠ¶æ€...</span>';

            try {
                const response = await fetch('http://localhost:3000');
                if (response.ok) {
                    output.innerHTML += '<br><span class="success">âœ… Reactåº”ç”¨è¿è¡Œæ­£å¸¸ (ç«¯å£3000)</span>';
                } else {
                    output.innerHTML += '<br><span class="error">âŒ Reactåº”ç”¨å“åº”å¼‚å¸¸</span>';
                }
            } catch (error) {
                output.innerHTML += '<br><span class="error">âŒ Reactåº”ç”¨æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®</span>';
            }
        }

        async function checkBackendAPI() {
            const output = document.getElementById('app-status');
            output.innerHTML += '<br><span class="info">ğŸ” æ£€æŸ¥åç«¯API...</span>';

            try {
                const response = await fetch('http://localhost:9000/api/config');
                if (response.ok) {
                    output.innerHTML += '<br><span class="success">âœ… åç«¯APIè¿è¡Œæ­£å¸¸ (ç«¯å£9000)</span>';
                } else {
                    output.innerHTML += '<br><span class="error">âŒ åç«¯APIå“åº”å¼‚å¸¸</span>';
                }
            } catch (error) {
                output.innerHTML += '<br><span class="error">âŒ åç«¯APIæœªè¿è¡Œæˆ–æ— æ³•è®¿é—®</span>';
            }
        }

        function openReactApp() {
            window.open('http://localhost:3000', '_blank');
        }

        function startInputMonitoring() {
            const output = document.getElementById('monitoring-output');
            output.innerHTML = '<span class="info">â±ï¸ å¼€å§‹å®æ—¶ç›‘æ§...</span>';

            monitoringInterval = setInterval(() => {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„ç›‘æ§é€»è¾‘
                const timestamp = new Date().toLocaleTimeString();
                output.innerHTML += \`<br><span class="info">[\${timestamp}] ç›‘æ§ä¸­...</span>\`;

                // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                output.scrollTop = output.scrollHeight;
            }, 3000);
        }

        function stopInputMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                const output = document.getElementById('monitoring-output');
                output.innerHTML += '<br><span class="warning">â¹ï¸ ç›‘æ§å·²åœæ­¢</span>';
            }
        }

        function injectDebugScript() {
            const script = \`
            // è¾“å…¥æ¡†è°ƒè¯•è„šæœ¬
            (function() {
                console.log('ğŸ”§ æ³¨å…¥è¾“å…¥æ¡†è°ƒè¯•è„šæœ¬...');

                window.debugInput = () => {
                    const inputs = document.querySelectorAll('.search-input');
                    console.log('æ‰¾åˆ°', inputs.length, 'ä¸ªè¾“å…¥æ¡†');
                    inputs.forEach((input, i) => {
                        const style = getComputedStyle(input);
                        console.log(\\\`è¾“å…¥æ¡† \\\${i}:\\\`, {
                            disabled: input.disabled,
                            readOnly: input.readOnly,
                            value: input.value,
                            style: {
                                pointerEvents: style.pointerEvents,
                                cursor: style.cursor,
                                opacity: style.opacity,
                                backgroundColor: style.backgroundColor,
                                color: style.color,
                                display: style.display,
                                visibility: style.visibility
                            }
                        });
                    });
                };

                window.forceFixInput = () => {
                    const inputs = document.querySelectorAll('.search-input');
                    inputs.forEach(input => {
                        input.removeAttribute('disabled');
                        input.removeAttribute('readonly');
                        input.style.setProperty('pointer-events', 'auto', 'important');
                        input.style.setProperty('cursor', 'text', 'important');
                        input.style.setProperty('opacity', '1', 'important');
                        input.style.setProperty('background-color', '#2a2a2a', 'important');
                        input.style.setProperty('color', '#fff', 'important');
                        input.dataset.fixedInput = 'true';
                        console.log('å·²ä¿®å¤è¾“å…¥æ¡†:', input);
                    });
                };

                // è‡ªåŠ¨ä¿®å¤
                window.forceFixInput();
                console.log('âœ… è°ƒè¯•è„šæœ¬æ³¨å…¥å®Œæˆ');
            })();
            \`;

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(script).then(() => {
                const output = document.getElementById('monitoring-output');
                output.innerHTML += '<br><span class="success">ğŸ“‹ è°ƒè¯•è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·åœ¨Reactåº”ç”¨çš„æ§åˆ¶å°ä¸­ç²˜è´´å¹¶è¿è¡Œ</span>';
            });
        }

        function copyCommands() {
            const commands = \`window.debugInput = () => {
  const inputs = document.querySelectorAll('.search-input');
  inputs.forEach((input, i) => {
    console.log(\\\`è¾“å…¥æ¡† \\\${i}:\\\`, {
      disabled: input.disabled,
      readOnly: input.readOnly,
      style: {
        pointerEvents: getComputedStyle(input).pointerEvents,
        cursor: getComputedStyle(input).cursor,
        opacity: getComputedStyle(input).opacity,
        backgroundColor: getComputedStyle(input).backgroundColor,
        color: getComputedStyle(input).color
      }
    });
  });
};

window.forceFixInput = () => {
  const inputs = document.querySelectorAll('.search-input');
  inputs.forEach(input => {
    input.removeAttribute('disabled');
    input.removeAttribute('readonly');
    input.style.pointerEvents = 'auto';
    input.style.cursor = 'text';
    input.style.opacity = '1';
    input.style.backgroundColor = '#2a2a2a';
    input.style.color = '#fff';
    input.focus();
    console.log('å·²ä¿®å¤è¾“å…¥æ¡†:', input);
  });
};\`;

            navigator.clipboard.writeText(commands).then(() => {
                alert('è°ƒè¯•å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        function rebuildReact() {
            const output = document.getElementById('build-output');
            output.innerHTML = '<span class="info">ğŸ”¨ æ­£åœ¨é‡æ–°æ„å»ºReactåº”ç”¨...</span>';

            // è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿï¼Œå®é™…éœ€è¦åç«¯æ”¯æŒ
            setTimeout(() => {
                output.innerHTML += '<br><span class="success">âœ… æ„å»ºå®Œæˆï¼ˆæ¨¡æ‹Ÿï¼‰</span>';
                output.innerHTML += '<br><span class="warning">âš ï¸ è¯·æ‰‹åŠ¨è¿è¡Œ: cd frontend && npm run build</span>';
            }, 2000);
        }

        function clearCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            localStorage.clear();
            sessionStorage.clear();
            const output = document.getElementById('build-output');
            output.innerHTML += '<br><span class="success">ğŸ—‘ï¸ æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤</span>';
        }

        function hardRefresh() {
            const output = document.getElementById('build-output');
            output.innerHTML += '<br><span class="info">ğŸ”„ æ‰§è¡Œç¡¬åˆ·æ–°...</span>';
            setTimeout(() => {
                window.location.reload(true);
            }, 1000);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            checkReactApp();
            checkBackendAPI();
        });
    </script>
</body>
</html>