<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ¿ç›‘æ§æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }
        .stat-box {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .board-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .board-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 15px;
        }
        .board-title {
            font-size: 18px;
            font-weight: bold;
        }
        .board-count {
            background: #1890ff;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
        }
        .stock-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .stock-card {
            border: 1px solid #e8e8e8;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .stock-card:hover {
            border-color: #1890ff;
            box-shadow: 0 2px 8px rgba(24,144,255,0.2);
        }
        .stock-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .stock-code {
            color: #666;
            font-size: 12px;
            margin-left: 8px;
        }
        .stock-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
            font-size: 13px;
        }
        .info-item {
            display: flex;
            justify-content: space-between;
        }
        .info-label {
            color: #999;
        }
        .info-value {
            font-weight: 500;
        }
        .gain {
            color: #ff4d4f;
        }
        .high-board {
            border-left: 3px solid #ff4d4f;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”¥ è¿æ¿ç›‘æ§</h1>
        <div class="stats" id="stats">
            <div class="stat-box">
                <div class="stat-value" id="totalBoards">-</div>
                <div class="stat-label">æ¶¨åœæ€»æ•°</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="continuousBoards">-</div>
                <div class="stat-label">è¿æ¿æ•°(â‰¥2æ¿)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="firstBoards">-</div>
                <div class="stat-label">é¦–æ¿æ•°</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="highBoards">-</div>
                <div class="stat-label">é«˜åº¦æ¿(â‰¥5æ¿)</div>
            </div>
        </div>
    </div>

    <div id="boardsContainer"></div>

    <script>
        async function fetchData() {
            try {
                console.log('ğŸ”„ å¼€å§‹è·å–æ¶¨åœæ•°æ®...');
                const response = await fetch('http://localhost:9000/api/market-scanner/limit-up?limit=100');
                const data = await response.json();

                console.log('ğŸ“Š APIè¿”å›æ•°æ®:', data);

                if (data.code === 200 && data.data && data.data.stocks) {
                    const stocks = data.data.stocks;
                    console.log(`âœ… è·å–åˆ° ${stocks.length} åªæ¶¨åœè‚¡ç¥¨`);

                    // æŒ‰è¿æ¿å¤©æ•°åˆ†ç»„
                    const grouped = {};
                    stocks.forEach(stock => {
                        const days = stock.consecutive_days || 1;
                        if (!grouped[days]) {
                            grouped[days] = [];
                        }
                        grouped[days].push(stock);
                    });

                    // æ›´æ–°ç»Ÿè®¡
                    const totalBoards = stocks.length;
                    const continuousBoards = stocks.filter(s => (s.consecutive_days || 1) >= 2).length;
                    const firstBoards = stocks.filter(s => (s.consecutive_days || 1) === 1).length;
                    const highBoards = stocks.filter(s => (s.consecutive_days || 1) >= 5).length;

                    document.getElementById('totalBoards').textContent = totalBoards;
                    document.getElementById('continuousBoards').textContent = continuousBoards;
                    document.getElementById('firstBoards').textContent = firstBoards;
                    document.getElementById('highBoards').textContent = highBoards;

                    // æ˜¾ç¤ºåˆ†ç»„
                    const container = document.getElementById('boardsContainer');
                    container.innerHTML = '';

                    // æŒ‰è¿æ¿æ•°å€’åºæ’åˆ—
                    const sortedLevels = Object.keys(grouped).map(Number).sort((a, b) => b - a);

                    sortedLevels.forEach(level => {
                        const stocks = grouped[level];
                        const section = document.createElement('div');
                        section.className = 'board-section';

                        const emoji = level >= 5 ? 'ğŸ”¥' : level >= 3 ? 'â­' : level >= 2 ? 'ğŸ¯' : '';

                        section.innerHTML = `
                            <div class="board-header">
                                <div class="board-title">${emoji} ${level}è¿æ¿</div>
                                <div class="board-count">${stocks.length}åª</div>
                            </div>
                            <div class="stock-grid">
                                ${stocks.map(stock => `
                                    <div class="stock-card ${level >= 5 ? 'high-board' : ''}">
                                        <div class="stock-name">
                                            ${stock.name}
                                            <span class="stock-code">${stock.code}</span>
                                        </div>
                                        <div class="stock-info">
                                            <div class="info-item">
                                                <span class="info-label">æ¶¨å¹…</span>
                                                <span class="info-value gain">+${(stock.change_percent || 0).toFixed(2)}%</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">æˆäº¤é¢</span>
                                                <span class="info-value">${(stock.amount / 100000000).toFixed(2)}äº¿</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">æ¢æ‰‹ç‡</span>
                                                <span class="info-value">${(stock.turnover_rate || 0).toFixed(2)}%</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-label">è¿æ¿æ•°</span>
                                                <span class="info-value" style="color: #ff4d4f;">${stock.consecutive_days || 1}æ¿</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;

                        container.appendChild(section);
                    });

                    console.log('âœ… é¡µé¢æ¸²æŸ“å®Œæˆ');
                } else {
                    document.getElementById('boardsContainer').innerHTML =
                        '<div class="loading">æš‚æ— æ•°æ®</div>';
                }
            } catch (error) {
                console.error('âŒ è·å–æ•°æ®å¤±è´¥:', error);
                document.getElementById('boardsContainer').innerHTML =
                    '<div class="loading">æ•°æ®åŠ è½½å¤±è´¥</div>';
            }
        }

        // åˆå§‹åŠ è½½
        fetchData();

        // æ¯30ç§’åˆ·æ–°
        setInterval(fetchData, 30000);
    </script>
</body>
</html>
