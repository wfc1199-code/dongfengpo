<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æµ‹è¯•çƒ­é—¨æ¿å—API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        .sector-card {
            background: #16213e;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #e94560;
        }
        .sector-name {
            font-size: 18px;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 8px;
        }
        .sector-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            font-size: 14px;
        }
        .stat-item {
            padding: 5px 10px;
            background: rgba(233, 69, 96, 0.1);
            border-radius: 4px;
        }
        .positive { color: #ff4d4f; }
        .negative { color: #52c41a; }
        .confirmed {
            display: inline-block;
            padding: 2px 8px;
            background: #52c41a;
            color: white;
            border-radius: 3px;
            font-size: 12px;
        }
        button {
            padding: 10px 20px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #c23b51;
        }
        #loading {
            text-align: center;
            padding: 20px;
            color: #f39c12;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ çƒ­é—¨æ¿å—æµ‹è¯•</h1>
    <div>
        <button onclick="testBackendAPI()">æµ‹è¯•åç«¯API</button>
        <button onclick="testMockData()">æµ‹è¯•æ¨¡æ‹Ÿæ•°æ®</button>
    </div>
    <div id="loading" style="display: none;">åŠ è½½ä¸­...</div>
    <div id="result"></div>

    <script>
        async function testBackendAPI() {
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');

            loadingDiv.style.display = 'block';
            resultDiv.innerHTML = '';

            try {
                const response = await fetch('http://localhost:9000/api/market-scanner/hot-sectors?limit=10');
                const data = await response.json();

                console.log('APIè¿”å›æ•°æ®:', data);

                if (data.code === 200 && data.data.sectors) {
                    displaySectors(data.data.sectors, data.data.data_source);
                } else {
                    resultDiv.innerHTML = '<p style="color: #ff4d4f;">APIè¿”å›é”™è¯¯: ' + (data.message || 'æœªçŸ¥é”™è¯¯') + '</p>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<p style="color: #ff4d4f;">è¯·æ±‚å¤±è´¥: ' + error.message + '</p>';
                console.error('è¯·æ±‚å¤±è´¥:', error);
            } finally {
                loadingDiv.style.display = 'none';
            }
        }

        function testMockData() {
            // æ¨¡æ‹Ÿæ‚¨æˆªå›¾ä¸­çš„æ•°æ®æ ¼å¼
            const mockSectors = [
                {
                    sector_name: "é”‚ç”µæ± æ¦‚å¿µ",
                    avg_change: 0.98,
                    up_count: 282,
                    down_count: 178,
                    limit_up_count: 9,
                    is_confirmed: true,
                    rank: 1
                },
                {
                    sector_name: "èŠ¯ç‰‡æ¦‚å¿µ",
                    avg_change: 0.81,
                    up_count: 320,
                    down_count: 211,
                    limit_up_count: 14,
                    is_confirmed: true,
                    rank: 2
                },
                {
                    sector_name: "å†›å·¥",
                    avg_change: 0.98,
                    up_count: 368,
                    down_count: 210,
                    limit_up_count: 6,
                    is_confirmed: false,
                    rank: 3
                },
                {
                    sector_name: "æœºå™¨äººæ¦‚å¿µ",
                    avg_change: 0.86,
                    up_count: 459,
                    down_count: 196,
                    limit_up_count: 10,
                    is_confirmed: false,
                    rank: 4
                },
                {
                    sector_name: "å…‰ä¼æ¦‚å¿µ",
                    avg_change: 0.93,
                    up_count: 281,
                    down_count: 171,
                    limit_up_count: 9,
                    is_confirmed: false,
                    rank: 5
                },
                {
                    sector_name: "é‡‘å±é“œ",
                    avg_change: 3.34,
                    up_count: 58,
                    down_count: 7,
                    limit_up_count: 7,
                    is_confirmed: false,
                    rank: 6
                },
                {
                    sector_name: "ç”µæ± ",
                    avg_change: 2.02,
                    up_count: 76,
                    down_count: 25,
                    limit_up_count: 4,
                    is_confirmed: false,
                    rank: 7
                },
                {
                    sector_name: "å°é‡‘å±æ¦‚å¿µ",
                    avg_change: 2.58,
                    up_count: 68,
                    down_count: 15,
                    limit_up_count: 4,
                    is_confirmed: false,
                    rank: 8
                }
            ];

            displaySectors(mockSectors, 'mock_data');
        }

        function displaySectors(sectors, dataSource) {
            const resultDiv = document.getElementById('result');

            let html = `<h2>æ•°æ®æº: ${dataSource}</h2>`;

            sectors.forEach(sector => {
                const changeClass = sector.avg_change >= 0 ? 'positive' : 'negative';

                html += `
                    <div class="sector-card">
                        <div class="sector-name">
                            ${sector.rank}. ${sector.sector_name}
                            ${sector.is_confirmed ? '<span class="confirmed">ç¡®æƒ</span>' : ''}
                        </div>
                        <div class="sector-stats">
                            ${sector.limit_up_count > 0 ?
                                `<div class="stat-item positive">
                                    <strong>${sector.limit_up_count}â†‘æ¶¨åœ</strong> ${sector.avg_change.toFixed(2)}%
                                </div>` :
                                `<div class="stat-item ${changeClass}">
                                    æ¶¨è·Œå¹…: ${sector.avg_change >= 0 ? '+' : ''}${sector.avg_change.toFixed(2)}%
                                </div>`
                            }
                            ${sector.up_count !== undefined && sector.down_count !== undefined ?
                                `<div class="stat-item">
                                    æ¶¨<span class="positive">${sector.up_count}</span>/
                                    <span class="negative">${sector.down_count}</span>è·Œ
                                </div>` : ''
                            }
                            ${sector.stock_count ?
                                `<div class="stat-item">
                                    ${sector.stock_count}åªè‚¡ç¥¨
                                </div>` : ''
                            }
                            ${sector.leading_stock ?
                                `<div class="stat-item">
                                    é¾™å¤´: ${sector.leading_stock}
                                </div>` : ''
                            }
                        </div>
                    </div>
                `;
            });

            resultDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            testBackendAPI();
        };
    </script>
</body>
</html>
