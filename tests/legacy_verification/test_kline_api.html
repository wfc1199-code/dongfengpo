<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Kçº¿APIæ•°æ®æµ‹è¯•</title>
    <style>
        body {
            margin: 20px;
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        button {
            background: #00da3c;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #00ff4c;
        }
        pre {
            background: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            overflow: auto;
            max-height: 600px;
            white-space: pre-wrap;
        }
        .info {
            background: #222;
            border: 1px solid #444;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Kçº¿APIæ•°æ®æ ¼å¼æµ‹è¯•</h1>
        
        <div class="info">
            <p>æµ‹è¯•ä¸åŒå‘¨æœŸKçº¿æ•°æ®çš„æ—¥æœŸæ ¼å¼ï¼Œæ‰¾å‡ºåˆ†éš”çº¿ä¸æ˜¾ç¤ºçš„åŸå› </p>
        </div>
        
        <div>
            <button onclick="testDailyKline()">æµ‹è¯•æ—¥Kçº¿</button>
            <button onclick="test5MinKline()">æµ‹è¯•5åˆ†é’ŸKçº¿</button>
            <button onclick="test15MinKline()">æµ‹è¯•15åˆ†é’ŸKçº¿</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        const stockCode = '600000'; // æµ¦å‘é“¶è¡Œ
        
        async function fetchKlineData(period, periodName) {
            resultsDiv.innerHTML += `<h3>ğŸ“Š ${periodName}æ•°æ®</h3>`;
            
            try {
                const response = await fetch(`http://localhost:9000/api/kline/${stockCode}?period=${period}&count=50`);
                const data = await response.json();
                
                if (data.status === 'success' && data.data) {
                    const klines = data.data;
                    
                    // æ˜¾ç¤ºå‰5æ¡å’Œå5æ¡æ•°æ®
                    const firstFive = klines.slice(0, 5);
                    const lastFive = klines.slice(-5);
                    
                    resultsDiv.innerHTML += `<pre>æ€»æ•°æ®æ¡æ•°: ${klines.length}

å‰5æ¡æ•°æ®:
${JSON.stringify(firstFive, null, 2)}

å5æ¡æ•°æ®:
${JSON.stringify(lastFive, null, 2)}

æ—¥æœŸæ ¼å¼åˆ†æ:
ç¬¬ä¸€æ¡æ—¥æœŸ: ${firstFive[0]?.date}
æœ€åä¸€æ¡æ—¥æœŸ: ${lastFive[lastFive.length - 1]?.date}
</pre>`;
                    
                    // æ£€æµ‹æ—¥æœŸå˜åŒ–
                    analyzeDataTransitions(klines, periodName);
                    
                } else {
                    resultsDiv.innerHTML += `<pre>é”™è¯¯: ${JSON.stringify(data)}</pre>`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<pre>è¯·æ±‚å¤±è´¥: ${error.message}</pre>`;
            }
        }
        
        function analyzeDataTransitions(klines, periodName) {
            resultsDiv.innerHTML += `<h4>æ—¥æœŸå˜åŒ–åˆ†æ (${periodName})</h4><pre>`;
            
            let lastDate = null;
            let transitions = [];
            
            klines.forEach((item, index) => {
                let currentDate = item.date;
                
                // æå–æ—¥æœŸéƒ¨åˆ†
                if (currentDate.includes(' ')) {
                    currentDate = currentDate.split(' ')[0];
                } else if (currentDate.includes('T')) {
                    currentDate = currentDate.split('T')[0];
                }
                
                if (lastDate && currentDate !== lastDate) {
                    transitions.push({
                        index: index,
                        fromDate: lastDate,
                        toDate: currentDate,
                        fullDate: item.date
                    });
                }
                lastDate = currentDate;
            });
            
            if (transitions.length > 0) {
                resultsDiv.innerHTML += `æ£€æµ‹åˆ° ${transitions.length} ä¸ªæ—¥æœŸå˜åŒ–ç‚¹:\n`;
                transitions.forEach(t => {
                    resultsDiv.innerHTML += `  Index ${t.index}: ${t.fromDate} -> ${t.toDate} (å®Œæ•´: ${t.fullDate})\n`;
                });
            } else {
                resultsDiv.innerHTML += `æœªæ£€æµ‹åˆ°æ—¥æœŸå˜åŒ–ï¼ˆæ‰€æœ‰æ•°æ®åœ¨åŒä¸€å¤©ï¼‰\n`;
            }
            
            resultsDiv.innerHTML += `</pre>`;
        }
        
        function testDailyKline() {
            fetchKlineData('daily', 'æ—¥Kçº¿');
        }
        
        function test5MinKline() {
            fetchKlineData('5min', '5åˆ†é’ŸKçº¿');
        }
        
        function test15MinKline() {
            fetchKlineData('15min', '15åˆ†é’ŸKçº¿');
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        // é»˜è®¤æµ‹è¯•5åˆ†é’ŸKçº¿
        test5MinKline();
    </script>
</body>
</html>