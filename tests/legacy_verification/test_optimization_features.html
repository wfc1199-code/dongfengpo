<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸œé£ç ´ä¼˜åŒ–åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .feature-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .feature-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        .feature-title::before {
            content: "âœ…";
            margin-right: 8px;
        }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #2980b9;
        }
        .result-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            min-height: 100px;
            overflow-y: auto;
            max-height: 300px;
            font-family: Monaco, 'Courier New', monospace;
            font-size: 12px;
        }
        .loading {
            color: #ffa500;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 12px;
        }
        .data-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .status-bar {
            background: #34495e;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ä¸œé£ç ´ä¼˜åŒ–åŠŸèƒ½æµ‹è¯•é¢æ¿</h1>
        
        <div class="status-bar">
            <div id="status">ç³»ç»ŸçŠ¶æ€: <span id="system-status">æ£€æŸ¥ä¸­...</span></div>
        </div>

        <div class="feature-grid">
            <!-- å¸‚åœºæ‰«æå™¨ -->
            <div class="feature-card">
                <div class="feature-title">å…¨å¸‚åœºè‚¡ç¥¨æ‰«æå™¨</div>
                <button class="test-button" onclick="testMarketScanner('top-gainers', 5)">æ¶¨å¹…æ¦œ TOP5</button>
                <button class="test-button" onclick="testMarketScanner('top-losers', 5)">è·Œå¹…æ¦œ TOP5</button>
                <button class="test-button" onclick="testMarketScanner('top-volume', 5)">æˆäº¤é‡æ¦œ TOP5</button>
                <button class="test-button" onclick="testMarketScanner('limit-up', 5)">æ¶¨åœæ¿</button>
                <button class="test-button" onclick="testMarketScanner('volume-surge', 5)">æ”¾é‡å¼‚åŠ¨</button>
                <div class="result-area" id="scanner-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•å¸‚åœºæ‰«æåŠŸèƒ½...</div>
            </div>

            <!-- å®æ—¶æ’è¡Œæ¦œ -->
            <div class="feature-card">
                <div class="feature-title">å®æ—¶æ’è¡Œæ¦œç³»ç»Ÿ</div>
                <button class="test-button" onclick="testRankings('gainers', 5)">æ¶¨å¹…æ’è¡Œæ¦œ</button>
                <button class="test-button" onclick="testRankings('volume', 5)">æˆäº¤é‡æ’è¡Œæ¦œ</button>
                <button class="test-button" onclick="testRankings('turnover', 5)">æ¢æ‰‹ç‡æ’è¡Œæ¦œ</button>
                <button class="test-button" onclick="testRankings('amplitude', 5)">æŒ¯å¹…æ’è¡Œæ¦œ</button>
                <button class="test-button" onclick="getRankingTypes()">è·å–æ’è¡Œç±»å‹</button>
                <div class="result-area" id="rankings-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ’è¡Œæ¦œåŠŸèƒ½...</div>
            </div>

            <!-- æ™ºèƒ½é€‰è‚¡ -->
            <div class="feature-card">
                <div class="feature-title">æ™ºèƒ½é€‰è‚¡ç³»ç»Ÿ</div>
                <button class="test-button" onclick="testSmartSelection('composite', 5)">ç»¼åˆç­–ç•¥</button>
                <button class="test-button" onclick="testSmartSelection('volume_breakout', 5)">æ”¾é‡çªç ´</button>
                <button class="test-button" onclick="testSmartSelection('strong_momentum', 5)">å¼ºåŠ¿åŠ¨é‡</button>
                <button class="test-button" onclick="testSmartSelection('oversold_rebound', 5)">è¶…è·Œåå¼¹</button>
                <button class="test-button" onclick="testSmartSelection('steady_growth', 5)">ç¨³å¥å¢é•¿</button>
                <div class="result-area" id="selection-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ™ºèƒ½é€‰è‚¡åŠŸèƒ½...</div>
            </div>

            <!-- è‚¡ç¥¨æ± ç®¡ç† -->
            <div class="feature-card">
                <div class="feature-title">åŠ¨æ€è‚¡ç¥¨æ± ç®¡ç†</div>
                <button class="test-button" onclick="testStockPool('all')">è·å–æ‰€æœ‰è‚¡ç¥¨</button>
                <button class="test-button" onclick="testStockPool('active')">æ´»è·ƒè‚¡ç¥¨æ± </button>
                <button class="test-button" onclick="testStockPool('hot')">çƒ­é—¨è‚¡ç¥¨</button>
                <button class="test-button" onclick="getPoolStats()">æ± ç»Ÿè®¡ä¿¡æ¯</button>
                <button class="test-button" onclick="refreshPool()">åˆ·æ–°è‚¡ç¥¨æ± </button>
                <div class="result-area" id="pool-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•è‚¡ç¥¨æ± ç®¡ç†åŠŸèƒ½...</div>
            </div>

            <!-- æ¿å—è½®åŠ¨æ£€æµ‹ -->
            <div class="feature-card">
                <div class="feature-title">æ¿å—è½®åŠ¨æ£€æµ‹</div>
                <button class="test-button" onclick="testSectorRotation()">è·å–è½®åŠ¨åˆ†æ</button>
                <button class="test-button" onclick="testRotationSignals()">è·å–è½®åŠ¨ä¿¡å·</button>
                <button class="test-button" onclick="testSectorAnalysis()">æ¿å—åˆ†æ</button>
                <div class="result-area" id="rotation-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ¿å—è½®åŠ¨åŠŸèƒ½...</div>
            </div>

            <!-- æ™ºèƒ½é¢„è­¦ç³»ç»Ÿ -->
            <div class="feature-card">
                <div class="feature-title">æ™ºèƒ½é¢„è­¦ç³»ç»Ÿ</div>
                <button class="test-button" onclick="testAlerts()">è·å–å½“å‰é¢„è­¦</button>
                <button class="test-button" onclick="scanAlerts()">æ‰«æç”Ÿæˆé¢„è­¦</button>
                <button class="test-button" onclick="testWatchlist('add', ['000001', '600519'])">æ·»åŠ è‡ªé€‰è‚¡</button>
                <button class="test-button" onclick="testWatchlist('remove', ['000001'])">ç§»é™¤è‡ªé€‰è‚¡</button>
                <div class="result-area" id="alerts-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æ™ºèƒ½é¢„è­¦åŠŸèƒ½...</div>
            </div>

            <!-- å¸‚åœºæ¦‚å†µ -->
            <div class="feature-card">
                <div class="feature-title">å¸‚åœºæ¦‚å†µåˆ†æ</div>
                <button class="test-button" onclick="testMarketSummary()">å¸‚åœºæ¦‚å†µ</button>
                <button class="test-button" onclick="testSectorAnalysis()">æ¿å—åˆ†æ</button>
                <button class="test-button" onclick="testActiveStocks()">æ´»è·ƒè‚¡ç¥¨</button>
                <div class="result-area" id="market-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•å¸‚åœºæ¦‚å†µåŠŸèƒ½...</div>
            </div>

            <!-- ç³»ç»Ÿå¥åº·æ£€æŸ¥ -->
            <div class="feature-card">
                <div class="feature-title">ç³»ç»Ÿç›‘æ§</div>
                <button class="test-button" onclick="healthCheck()">ç³»ç»Ÿå¥åº·æ£€æŸ¥</button>
                <button class="test-button" onclick="testAllEndpoints()">å…¨åŠŸèƒ½æµ‹è¯•</button>
                <div class="result-area" id="health-result">ç‚¹å‡»æŒ‰é’®æµ‹è¯•ç³»ç»ŸçŠ¶æ€...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:9000/api';
        
        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        async function checkSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/market-scanner/health`);
                const data = await response.json();
                document.getElementById('system-status').innerHTML = 
                    `<span style="color: #2ecc71;">âœ… ${data.status}</span> | äº¤æ˜“æ—¶é—´: ${data.trading_hours ? 'æ˜¯' : 'å¦'}`;
            } catch (error) {
                document.getElementById('system-status').innerHTML = 
                    `<span style="color: #e74c3c;">âŒ è¿æ¥å¤±è´¥</span>`;
            }
        }

        // å¸‚åœºæ‰«æå™¨æµ‹è¯•
        async function testMarketScanner(type, limit) {
            const resultArea = document.getElementById('scanner-result');
            resultArea.innerHTML = '<span class="loading">â³ æ‰«æä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/${type}?limit=${limit}`);
                const data = await response.json();
                
                if (data.status === 'success' && data.stocks.length > 0) {
                    let html = `<div class="success">âœ… æ‰«æå®Œæˆï¼Œæ‰¾åˆ° ${data.count} åªè‚¡ç¥¨</div>`;
                    html += '<table class="data-table"><tr><th>ä»£ç </th><th>åç§°</th><th>ä»·æ ¼</th><th>æ¶¨å¹…%</th><th>æˆäº¤é‡</th><th>æ¢æ‰‹ç‡%</th></tr>';
                    
                    data.stocks.slice(0, 5).forEach(stock => {
                        const changeColor = stock.change_percent >= 0 ? '#e74c3c' : '#27ae60';
                        html += `<tr>
                            <td>${stock.code}</td>
                            <td>${stock.name}</td>
                            <td>${stock.price.toFixed(2)}</td>
                            <td style="color:${changeColor}">${stock.change_percent.toFixed(2)}%</td>
                            <td>${(stock.volume/10000).toFixed(0)}ä¸‡</td>
                            <td>${stock.turnover_rate.toFixed(2)}%</td>
                        </tr>`;
                    });
                    html += '</table>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°æ•°æ®</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ’è¡Œæ¦œæµ‹è¯•
        async function testRankings(type, limit) {
            const resultArea = document.getElementById('rankings-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/rankings/${type}?limit=${limit}`);
                const data = await response.json();
                
                if (data.status === 'success' && data.stocks.length > 0) {
                    let html = `<div class="success">âœ… è·å–æˆåŠŸï¼Œå…± ${data.count} åªè‚¡ç¥¨</div>`;
                    html += '<table class="data-table"><tr><th>æ’å</th><th>ä»£ç </th><th>åç§°</th><th>ä»·æ ¼</th><th>æ¶¨å¹…%</th><th>æ’åå€¼</th></tr>';
                    
                    data.stocks.slice(0, 5).forEach(stock => {
                        const changeColor = stock.change_percent >= 0 ? '#e74c3c' : '#27ae60';
                        html += `<tr>
                            <td>${stock.ranking}</td>
                            <td>${stock.code}</td>
                            <td>${stock.name}</td>
                            <td>${stock.price.toFixed(2)}</td>
                            <td style="color:${changeColor}">${stock.change_percent.toFixed(2)}%</td>
                            <td>${stock.ranking_value.toFixed(2)}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°æ’è¡Œæ¦œæ•°æ®</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // è·å–æ’è¡Œæ¦œç±»å‹
        async function getRankingTypes() {
            const resultArea = document.getElementById('rankings-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/ranking-types`);
                const data = await response.json();
                
                let html = '<div class="success">âœ… æ”¯æŒçš„æ’è¡Œæ¦œç±»å‹:</div>';
                data.ranking_types.forEach(type => {
                    html += `<div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 3px;">
                        ${type.icon} <strong>${type.name}</strong> (${type.value}): ${type.description}
                    </div>`;
                });
                resultArea.innerHTML = html;
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ™ºèƒ½é€‰è‚¡æµ‹è¯•
        async function testSmartSelection(strategy, limit) {
            const resultArea = document.getElementById('selection-result');
            resultArea.innerHTML = '<span class="loading">â³ é€‰è‚¡ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/smart-selection/realtime-select?strategy=${strategy}&top_n=${limit}`);
                const data = await response.json();
                
                if (data.status === 'success' && data.signals && data.signals.length > 0) {
                    let html = `<div class="success">âœ… é€‰è‚¡å®Œæˆï¼Œå…± ${data.signals.length} åªè‚¡ç¥¨</div>`;
                    html += '<table class="data-table"><tr><th>ä»£ç </th><th>åç§°</th><th>ä»·æ ¼</th><th>æ¶¨å¹…%</th><th>è¯„åˆ†</th><th>ç†ç”±</th></tr>';
                    
                    data.signals.slice(0, 5).forEach(signal => {
                        const changeColor = signal.change_percent >= 0 ? '#e74c3c' : '#27ae60';
                        html += `<tr>
                            <td>${signal.code}</td>
                            <td>${signal.name}</td>
                            <td>${signal.price ? signal.price.toFixed(2) : 'N/A'}</td>
                            <td style="color:${changeColor}">${signal.change_percent ? signal.change_percent.toFixed(2) : '0.00'}%</td>
                            <td>${signal.score ? signal.score.toFixed(1) : 'N/A'}</td>
                            <td>${signal.reason || signal.signals ? signal.signals.join(', ') : 'æ— '}</td>
                        </tr>`;
                    });
                    html += '</table>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // è‚¡ç¥¨æ± æµ‹è¯•
        async function testStockPool(category) {
            const resultArea = document.getElementById('pool-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–ä¸­...</span>';
            
            try {
                let url;
                if (category === 'hot') {
                    url = `${API_BASE}/stock-pool/hot?limit=10`;
                } else {
                    url = `${API_BASE}/stock-pool/stocks/${category}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const stocks = data.stocks || data.hot_stocks || [];
                    let html = `<div class="success">âœ… è·å–æˆåŠŸï¼Œå…± ${data.count || stocks.length} åªè‚¡ç¥¨</div>`;
                    html += `<div style="margin: 10px 0;">ç±»åˆ«: ${data.category || category}</div>`;
                    html += '<div style="max-height: 150px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 5px;">';
                    stocks.slice(0, 20).forEach((stock, index) => {
                        html += `<span style="display: inline-block; margin: 2px; padding: 3px 6px; background: #e3f2fd; border-radius: 3px; font-size: 12px;">${stock}</span>`;
                    });
                    html += '</div>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°è‚¡ç¥¨æ± æ•°æ®</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // è·å–æ± ç»Ÿè®¡
        async function getPoolStats() {
            const resultArea = document.getElementById('pool-result');
            resultArea.innerHTML = '<span class="loading">â³ ç»Ÿè®¡ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/stock-pool/stats`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = '<div class="success">âœ… ç»Ÿè®¡ä¿¡æ¯è·å–æˆåŠŸ</div>';
                    html += '<table class="data-table"><tr><th>ç±»åˆ«</th><th>è‚¡ç¥¨æ•°é‡</th></tr>';
                    
                    Object.entries(data.stats).forEach(([category, count]) => {
                        const categoryNames = {
                            'all': 'æ‰€æœ‰è‚¡ç¥¨',
                            'watchlist': 'è‡ªé€‰è‚¡',
                            'active': 'æ´»è·ƒè‚¡',
                            'bluechip': 'è“ç­¹è‚¡',
                            'tech': 'ç§‘æŠ€è‚¡',
                            'energy': 'æ–°èƒ½æº',
                            'medical': 'åŒ»è¯è‚¡',
                            'consumer': 'æ¶ˆè´¹è‚¡',
                            'finance': 'é‡‘èè‚¡'
                        };
                        html += `<tr><td>${categoryNames[category] || category}</td><td>${count}</td></tr>`;
                    });
                    html += '</table>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // åˆ·æ–°è‚¡ç¥¨æ± 
        async function refreshPool() {
            const resultArea = document.getElementById('pool-result');
            resultArea.innerHTML = '<span class="loading">â³ åˆ·æ–°ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/stock-pool/refresh`, { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'success') {
                    resultArea.innerHTML = `<div class="success">âœ… ${data.message}ï¼Œå…± ${data.count} åªè‚¡ç¥¨</div>`;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ åˆ·æ–°å¤±è´¥</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ¿å—è½®åŠ¨æµ‹è¯•
        async function testSectorRotation() {
            const resultArea = document.getElementById('rotation-result');
            resultArea.innerHTML = '<span class="loading">â³ åˆ†æä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/sector-rotation`);
                const data = await response.json();
                
                if (data.status === 'success' && data.data) {
                    let html = '<div class="success">âœ… æ¿å—è½®åŠ¨åˆ†æå®Œæˆ</div>';
                    
                    if (data.data.sector_analysis && data.data.sector_analysis.summary) {
                        const summary = data.data.sector_analysis.summary;
                        html += `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>å¸‚åœºæ¦‚å†µ:</strong> ${summary.total_sectors || 0} ä¸ªæ¿å—ï¼Œ
                            å¹³å‡æ¶¨å¹…: ${summary.avg_change_percent ? summary.avg_change_percent.toFixed(2) : '0.00'}%ï¼Œ
                            å¸‚åœºæƒ…ç»ª: ${summary.market_sentiment === 'bullish' ? 'ğŸ‚ ä¹è§‚' : 'ğŸ» æ‚²è§‚'}
                        </div>`;
                    }
                    
                    if (data.data.rotation_signals && data.data.rotation_signals.length > 0) {
                        html += '<div><strong>è½®åŠ¨ä¿¡å·:</strong></div>';
                        data.data.rotation_signals.forEach(signal => {
                            html += `<div style="margin: 5px 0; padding: 8px; background: #fff3cd; border-radius: 3px; font-size: 14px;">
                                ${signal.from_sector} â†’ ${signal.to_sector} (${signal.rotation_type})
                                <br>å¼ºåº¦: ${signal.strength.toFixed(1)}ï¼Œç½®ä¿¡åº¦: ${signal.confidence.toFixed(2)}
                                <br>ç†ç”±: ${signal.reason}
                            </div>`;
                        });
                    } else {
                        html += '<div style="color: #6c757d;">æš‚æ— æ˜æ˜¾è½®åŠ¨ä¿¡å·</div>';
                    }
                    
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ¿å—åˆ†ææ•°æ®ä¸ºç©º</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // è½®åŠ¨ä¿¡å·æµ‹è¯•
        async function testRotationSignals() {
            const resultArea = document.getElementById('rotation-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–ä¿¡å·ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/sector-rotation/signals`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = `<div class="success">âœ… è·å–åˆ° ${data.count} ä¸ªè½®åŠ¨ä¿¡å·</div>`;
                    
                    if (data.signals.length > 0) {
                        data.signals.forEach(signal => {
                            html += `<div style="margin: 10px 0; padding: 10px; background: #d4edda; border-radius: 5px;">
                                <strong>${signal.from_sector} â†’ ${signal.to_sector}</strong>
                                <br>ç±»å‹: ${signal.rotation_type}
                                <br>å¼ºåº¦: ${signal.strength.toFixed(1)}ï¼Œç½®ä¿¡åº¦: ${(signal.confidence * 100).toFixed(1)}%
                                <br>ç†ç”±: ${signal.reason}
                                <br>é¢„æœŸæŒç»­: ${signal.expected_duration || 'æœªçŸ¥'}
                            </div>`;
                        });
                    } else {
                        html += '<div style="color: #6c757d;">æš‚æ— è½®åŠ¨ä¿¡å·</div>';
                    }
                    
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ è·å–è½®åŠ¨ä¿¡å·å¤±è´¥</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ™ºèƒ½é¢„è­¦æµ‹è¯•
        async function testAlerts() {
            const resultArea = document.getElementById('alerts-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–é¢„è­¦ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/alerts`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = `<div class="success">âœ… å½“å‰æ´»è·ƒé¢„è­¦: ${data.count} ä¸ª</div>`;
                    
                    if (data.alerts.length > 0) {
                        data.alerts.forEach(alert => {
                            const levelColors = {
                                'critical': '#dc3545',
                                'high': '#fd7e14',
                                'medium': '#ffc107',
                                'low': '#28a745'
                            };
                            const levelNames = {
                                'critical': 'ğŸš¨ ç´§æ€¥',
                                'high': 'âš ï¸ é«˜',
                                'medium': 'ğŸ“ ä¸­',
                                'low': 'ğŸ’¡ ä½'
                            };
                            
                            html += `<div style="margin: 10px 0; padding: 10px; border-left: 4px solid ${levelColors[alert.level]}; background: #f8f9fa;">
                                <div style="font-weight: bold;">${alert.title}</div>
                                <div style="color: ${levelColors[alert.level]};">${levelNames[alert.level]} | ${alert.stock_code} ${alert.stock_name}</div>
                                <div style="margin: 5px 0;">${alert.message}</div>
                                <div style="font-size: 12px; color: #6c757d;">è§¦å‘æ—¶é—´: ${new Date(alert.triggered_at).toLocaleString()}</div>
                            </div>`;
                        });
                    } else {
                        html += '<div style="color: #6c757d;">æš‚æ— æ´»è·ƒé¢„è­¦</div>';
                    }
                    
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ è·å–é¢„è­¦å¤±è´¥</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ‰«æé¢„è­¦
        async function scanAlerts() {
            const resultArea = document.getElementById('alerts-result');
            resultArea.innerHTML = '<span class="loading">â³ æ‰«æé¢„è­¦ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/alerts/scan`, { method: 'POST' });
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = `<div class="success">âœ… ${data.message}</div>`;
                    
                    if (data.new_alerts.length > 0) {
                        html += '<div><strong>æ–°é¢„è­¦:</strong></div>';
                        data.new_alerts.forEach(alert => {
                            html += `<div style="margin: 5px 0; padding: 8px; background: #fff3cd; border-radius: 3px;">
                                ${alert.title}: ${alert.message}
                            </div>`;
                        });
                    } else {
                        html += '<div style="color: #6c757d;">æœªå‘ç°æ–°é¢„è­¦</div>';
                    }
                    
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ‰«æé¢„è­¦å¤±è´¥</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // ç®¡ç†è‡ªé€‰è‚¡
        async function testWatchlist(action, stocks) {
            const resultArea = document.getElementById('alerts-result');
            resultArea.innerHTML = '<span class="loading">â³ å¤„ç†ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/alerts/watchlist?action=${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, stock_codes: stocks })
                });
                const data = await response.json();
                
                if (data.status === 'success') {
                    resultArea.innerHTML = `<div class="success">âœ… ${data.message}ï¼Œè‡ªé€‰è‚¡æ± å¤§å°: ${data.watchlist_size}</div>`;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ“ä½œå¤±è´¥</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // å¸‚åœºæ¦‚å†µæµ‹è¯•
        async function testMarketSummary() {
            const resultArea = document.getElementById('market-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–æ¦‚å†µä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/market-summary`);
                const data = await response.json();
                
                if (data.status === 'success' && data.summary) {
                    const summary = data.summary;
                    let html = '<div class="success">âœ… å¸‚åœºæ¦‚å†µè·å–æˆåŠŸ</div>';
                    
                    html += `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <div><strong>å¸‚åœºæƒ…ç»ª:</strong> ${summary.market_sentiment === 'bullish' ? 'ğŸ‚ ä¹è§‚' : 'ğŸ» æ‚²è§‚'}</div>
                        <div><strong>ä¸Šæ¶¨å®¶æ•°:</strong> ${summary.gainers_count || 0}</div>
                        <div><strong>ä¸‹è·Œå®¶æ•°:</strong> ${summary.losers_count || 0}</div>
                        <div><strong>æ¶¨åœå®¶æ•°:</strong> ${summary.limit_up_count || 0}</div>
                    `;
                    
                    if (summary.top_gainer) {
                        html += `<div><strong>é¢†æ¶¨è‚¡:</strong> ${summary.top_gainer.name} (${summary.top_gainer.code}) +${summary.top_gainer.change_percent.toFixed(2)}%</div>`;
                    }
                    
                    if (summary.most_active) {
                        html += `<div><strong>æœ€æ´»è·ƒ:</strong> ${summary.most_active.name} (${summary.most_active.code}) æˆäº¤${(summary.most_active.amount/100000000).toFixed(1)}äº¿</div>`;
                    }
                    
                    html += '</div>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ å¸‚åœºæ¦‚å†µæ•°æ®ä¸ºç©º</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ¿å—åˆ†æ
        async function testSectorAnalysis() {
            const resultArea = document.getElementById('market-result');
            resultArea.innerHTML = '<span class="loading">â³ åˆ†ææ¿å—ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/sector-analysis`);
                const data = await response.json();
                
                if (data.status === 'success' && data.analysis) {
                    let html = '<div class="success">âœ… æ¿å—åˆ†æå®Œæˆ</div>';
                    
                    if (data.analysis.hot_sectors && data.analysis.hot_sectors.length > 0) {
                        html += '<div style="margin: 10px 0;"><strong>çƒ­é—¨æ¿å—:</strong></div>';
                        data.analysis.hot_sectors.forEach(sector => {
                            html += `<div style="margin: 5px 0; padding: 5px; background: #d4edda; border-radius: 3px;">
                                ${sector.name}: +${sector.change_percent.toFixed(2)}%
                            </div>`;
                        });
                    }
                    
                    if (data.analysis.cold_sectors && data.analysis.cold_sectors.length > 0) {
                        html += '<div style="margin: 10px 0;"><strong>å†·é—¨æ¿å—:</strong></div>';
                        data.analysis.cold_sectors.forEach(sector => {
                            html += `<div style="margin: 5px 0; padding: 5px; background: #f8d7da; border-radius: 3px;">
                                ${sector.name}: ${sector.change_percent.toFixed(2)}%
                            </div>`;
                        });
                    }
                    
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ¿å—åˆ†ææ•°æ®ä¸ºç©º</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ´»è·ƒè‚¡ç¥¨
        async function testActiveStocks() {
            const resultArea = document.getElementById('market-result');
            resultArea.innerHTML = '<span class="loading">â³ è·å–æ´»è·ƒè‚¡ç¥¨ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/active-stocks?limit=10`);
                const data = await response.json();
                
                if (data.status === 'success' && data.stocks.length > 0) {
                    let html = `<div class="success">âœ… è·å–åˆ° ${data.count} åªæ´»è·ƒè‚¡ç¥¨</div>`;
                    html += '<table class="data-table"><tr><th>ä»£ç </th><th>åç§°</th><th>ä»·æ ¼</th><th>æ¶¨å¹…%</th><th>æ¢æ‰‹ç‡%</th></tr>';
                    
                    data.stocks.slice(0, 10).forEach(stock => {
                        const changeColor = stock.change_percent >= 0 ? '#e74c3c' : '#27ae60';
                        html += `<tr>
                            <td>${stock.code}</td>
                            <td>${stock.name}</td>
                            <td>${stock.price.toFixed(2)}</td>
                            <td style="color:${changeColor}">${stock.change_percent.toFixed(2)}%</td>
                            <td>${stock.turnover_rate.toFixed(2)}%</td>
                        </tr>`;
                    });
                    html += '</table>';
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = '<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°æ´»è·ƒè‚¡ç¥¨æ•°æ®</div>';
                }
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
            }
        }

        // å¥åº·æ£€æŸ¥
        async function healthCheck() {
            const resultArea = document.getElementById('health-result');
            resultArea.innerHTML = '<span class="loading">â³ æ£€æŸ¥ä¸­...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/market-scanner/health`);
                const data = await response.json();
                
                let html = `<div class="success">âœ… ç³»ç»ŸçŠ¶æ€: ${data.status}</div>`;
                html += `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <div><strong>æœåŠ¡:</strong> ${data.service}</div>
                    <div><strong>äº¤æ˜“æ—¶é—´:</strong> ${data.trading_hours ? 'æ˜¯' : 'å¦'}</div>
                    <div><strong>æ—¶é—´æˆ³:</strong> ${new Date(data.timestamp).toLocaleString()}</div>
                </div>`;
                
                resultArea.innerHTML = html;
            } catch (error) {
                resultArea.innerHTML = `<div class="error">âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}</div>`;
            }
        }

        // å…¨åŠŸèƒ½æµ‹è¯•
        async function testAllEndpoints() {
            const resultArea = document.getElementById('health-result');
            resultArea.innerHTML = '<span class="loading">â³ å…¨é¢æµ‹è¯•ä¸­...</span>';
            
            const endpoints = [
                { name: 'å¸‚åœºæ‰«æå™¨', url: `${API_BASE}/market-scanner/health` },
                { name: 'æ¶¨å¹…æ¦œ', url: `${API_BASE}/market-scanner/top-gainers?limit=3` },
                { name: 'æ’è¡Œæ¦œ', url: `${API_BASE}/market-scanner/rankings/gainers?limit=3` },
                { name: 'æ™ºèƒ½é€‰è‚¡', url: `${API_BASE}/smart-selection/realtime-select?strategy=composite&top_n=3` },
                { name: 'è‚¡ç¥¨æ± ', url: `${API_BASE}/stock-pool/hot?limit=5` },
                { name: 'æ¿å—è½®åŠ¨', url: `${API_BASE}/market-scanner/sector-rotation/signals` },
                { name: 'æ™ºèƒ½é¢„è­¦', url: `${API_BASE}/market-scanner/alerts` },
                { name: 'å¸‚åœºæ¦‚å†µ', url: `${API_BASE}/market-scanner/market-summary` }
            ];
            
            let results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint.url);
                    const data = await response.json();
                    results.push({
                        name: endpoint.name,
                        status: response.ok ? 'âœ…' : 'âŒ',
                        message: data.status || 'æœªçŸ¥çŠ¶æ€'
                    });
                } catch (error) {
                    results.push({
                        name: endpoint.name,
                        status: 'âŒ',
                        message: 'è¿æ¥å¤±è´¥'
                    });
                }
            }
            
            let html = '<div class="success">ğŸ¯ å…¨åŠŸèƒ½æµ‹è¯•å®Œæˆ</div>';
            html += '<table class="data-table"><tr><th>åŠŸèƒ½æ¨¡å—</th><th>çŠ¶æ€</th><th>ç»“æœ</th></tr>';
            
            results.forEach(result => {
                html += `<tr>
                    <td>${result.name}</td>
                    <td>${result.status}</td>
                    <td>${result.message}</td>
                </tr>`;
            });
            html += '</table>';
            
            const successCount = results.filter(r => r.status === 'âœ…').length;
            html += `<div style="margin: 10px 0; font-weight: bold;">æµ‹è¯•ç»“æœ: ${successCount}/${results.length} ä¸ªæ¨¡å—æ­£å¸¸è¿è¡Œ</div>`;
            
            resultArea.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.onload = function() {
            checkSystemStatus();
            // æ¯30ç§’æ›´æ–°ä¸€æ¬¡ç³»ç»ŸçŠ¶æ€
            setInterval(checkSystemStatus, 30000);
        };
    </script>
</body>
</html>