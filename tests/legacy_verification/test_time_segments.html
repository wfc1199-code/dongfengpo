<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间分段涨停预测测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .segment { border: 1px solid #ccc; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .segment h3 { margin: 0 0 10px 0; color: #333; }
        .stock { background: #f9f9f9; margin: 5px 0; padding: 8px; border-radius: 4px; }
        .loading { color: #666; }
        .error { color: red; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>时间分段涨停预测测试</h1>
    
    <div>
        <button onclick="testAPI()">测试API</button>
        <button onclick="fetchSegments()">获取时间段定义</button>
        <button onclick="fetchPredictions()">获取预测数据</button>
    </div>
    
    <div id="status" class="loading">准备就绪</div>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const status = document.getElementById('status');
            const results = document.getElementById('results');
            
            status.textContent = '正在测试API连接...';
            results.innerHTML = '';
            
            try {
                // 测试后端连接
                const response = await fetch('http://localhost:9000/api/time-segmented/segments');
                if (response.ok) {
                    const data = await response.json();
                    status.textContent = 'API连接成功！';
                    status.className = '';
                    
                    results.innerHTML = `
                        <h2>API测试结果</h2>
                        <p><strong>状态:</strong> ${data.code}</p>
                        <p><strong>消息:</strong> ${data.message}</p>
                        <p><strong>时间段数量:</strong> ${data.data.segments.length}</p>
                        <h3>时间段列表:</h3>
                        <ul>
                            ${data.data.segments.map(s => `<li>${s.name} (${s.period}): ${s.description}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                status.textContent = `API连接失败: ${error.message}`;
                status.className = 'error';
            }
        }
        
        async function fetchSegments() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading">正在获取时间段定义...</div>';
            
            try {
                const response = await fetch('http://localhost:9000/api/time-segmented/segments');
                const data = await response.json();
                
                if (data.code === 200) {
                    results.innerHTML = `
                        <h2>时间段定义</h2>
                        ${data.data.segments.map(segment => `
                            <div class="segment">
                                <h3>${segment.name}</h3>
                                <p><strong>时间:</strong> ${segment.period}</p>
                                <p><strong>描述:</strong> ${segment.description}</p>
                                <p><strong>策略:</strong> ${segment.strategy}</p>
                            </div>
                        `).join('')}
                    `;
                } else {
                    results.innerHTML = `<div class="error">获取失败: ${data.message}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">请求失败: ${error.message}</div>`;
            }
        }
        
        async function fetchPredictions() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="loading">正在获取预测数据...</div>';
            
            try {
                const response = await fetch('http://localhost:9000/api/time-segmented/predictions');
                const data = await response.json();
                
                if (data.code === 200) {
                    results.innerHTML = `
                        <h2>时间分段预测结果</h2>
                        <p><strong>总股票数:</strong> ${data.data.statistics.total_stocks}</p>
                        <p><strong>非空时间段:</strong> ${data.data.statistics.non_empty_segments}</p>
                        <p><strong>更新时间:</strong> ${data.data.update_time}</p>
                        
                        ${data.data.segments.map(segmentData => `
                            <div class="segment">
                                <h3>${segmentData.segment.name} - ${segmentData.summary.count}只股票</h3>
                                <p><strong>平均分数:</strong> ${segmentData.summary.avg_score}</p>
                                <p><strong>平均涨幅:</strong> ${segmentData.summary.avg_change}%</p>
                                
                                ${segmentData.stocks.slice(0, 5).map(stock => `
                                    <div class="stock">
                                        <strong>${stock.name} (${stock.code})</strong> - 
                                        涨幅: ${stock.changePercent}%, 
                                        预测分数: ${stock.predictionScore}, 
                                        等级: ${stock.predictionLevel}
                                    </div>
                                `).join('')}
                                
                                ${segmentData.stocks.length > 5 ? `<p>...还有${segmentData.stocks.length - 5}只股票</p>` : ''}
                            </div>
                        `).join('')}
                    `;
                } else {
                    results.innerHTML = `<div class="error">获取失败: ${data.message}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">请求失败: ${error.message}</div>`;
            }
        }
        
        // 页面加载时自动测试
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>
