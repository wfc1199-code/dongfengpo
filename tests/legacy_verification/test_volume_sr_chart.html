<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºäºæˆäº¤é‡çš„æ”¯æ’‘é˜»åŠ›çº¿ - ä¸œé£ç ´</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .header p {
            color: #b0b0b0;
            line-height: 1.6;
        }
        
        .controls {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .control-group input,
        .control-group select {
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 14px;
            min-width: 120px;
        }
        
        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        
        .btn {
            padding: 10px 24px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        .btn.secondary:hover {
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }
        
        .chart-wrapper {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }
        
        .chart-info {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .info-label {
            color: #888;
        }
        
        .info-value {
            font-weight: 600;
        }
        
        .info-value.resistance {
            color: #f44336;
        }
        
        .info-value.support {
            color: #4CAF50;
        }
        
        .info-value.neutral {
            color: #FFC107;
        }
        
        .chart {
            width: 100%;
            height: 500px;
        }
        
        .signal-panel {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .signal-header {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .signal-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .signal-item {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #444;
        }
        
        .signal-item.buy {
            border-left-color: #4CAF50;
        }
        
        .signal-item.sell {
            border-left-color: #f44336;
        }
        
        .signal-item.hold {
            border-left-color: #FFC107;
        }
        
        .signal-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 3px;
        }
        
        .signal-value {
            font-size: 16px;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #444;
            border-top-color: #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 6px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        
        .multi-timeframe {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .timeframe-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .timeframe-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .timeframe-levels {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .level-block {
            flex: 1;
        }
        
        .level-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .level-price {
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š åŸºäºæˆäº¤é‡çš„æ”¯æ’‘é˜»åŠ›çº¿ç³»ç»Ÿ</h1>
            <p>
                è½¬æ¢è‡ªTradingViewçš„Volumatic Support/Resistance LevelsæŒ‡æ ‡<br>
                é€šè¿‡åˆ†æä»·æ ¼æå€¼å’Œæˆäº¤é‡åˆ†å¸ƒï¼Œè‡ªåŠ¨è¯†åˆ«å…³é”®æ”¯æ’‘é˜»åŠ›ä½<br>
                æ”¯æŒ5åˆ†é’Ÿã€15åˆ†é’Ÿã€æ—¥çº¿å¤šæ—¶é—´å‘¨æœŸåˆ†æ
            </p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>è‚¡ç¥¨ä»£ç </label>
                <input type="text" id="stockCode" value="02228" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç ">
            </div>
            
            <div class="control-group">
                <label>æ—¶é—´å‘¨æœŸ</label>
                <select id="period">
                    <option value="5min">5åˆ†é’Ÿ</option>
                    <option value="15min">15åˆ†é’Ÿ</option>
                    <option value="daily" selected>æ—¥çº¿</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>è®¡ç®—å‘¨æœŸ</label>
                <input type="number" id="length" value="25" min="10" max="50">
            </div>
            
            <div class="control-group">
                <label>é˜»åŠ›é˜ˆå€¼(%)</label>
                <input type="number" id="resistanceThreshold" value="80" min="50" max="100">
            </div>
            
            <div class="control-group">
                <label>æ”¯æ’‘é˜ˆå€¼(%)</label>
                <input type="number" id="supportThreshold" value="80" min="50" max="100">
            </div>
            
            <button class="btn" onclick="loadChart()">åŠ è½½å›¾è¡¨</button>
            <button class="btn secondary" onclick="loadMultiTimeframe()">å¤šå‘¨æœŸåˆ†æ</button>
        </div>
        
        <div class="charts-container">
            <div class="chart-wrapper">
                <div class="chart-header">
                    <div class="chart-title" id="chartTitle">Kçº¿å›¾ - åŠ è½½ä¸­...</div>
                    <div class="chart-info" id="chartInfo">
                        <div class="info-item">
                            <span class="info-label">é˜»åŠ›:</span>
                            <span class="info-value resistance" id="resistanceValue">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ”¯æ’‘:</span>
                            <span class="info-value support" id="supportValue">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å½“å‰:</span>
                            <span class="info-value neutral" id="currentValue">-</span>
                        </div>
                    </div>
                </div>
                <div id="klineChart" class="chart"></div>
                
                <div class="signal-panel" id="signalPanel">
                    <div class="signal-header">äº¤æ˜“ä¿¡å·åˆ†æ</div>
                    <div class="signal-content" id="signalContent">
                        <div class="loading">ç­‰å¾…æ•°æ®åŠ è½½...</div>
                    </div>
                </div>
                
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f44336;"></div>
                        <span>é˜»åŠ›ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4CAF50;"></div>
                        <span>æ”¯æ’‘ä½</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(244, 67, 54, 0.2);"></div>
                        <span>é˜»åŠ›å¸¦</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: rgba(76, 175, 80, 0.2);"></div>
                        <span>æ”¯æ’‘å¸¦</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-wrapper">
                <div class="chart-header">
                    <div class="chart-title">æˆäº¤é‡åˆ†æ</div>
                </div>
                <div id="volumeChart" class="chart"></div>
                
                <div class="multi-timeframe" id="multiTimeframe" style="display: none;">
                    <div class="timeframe-card">
                        <div class="timeframe-title">5åˆ†é’Ÿ</div>
                        <div class="timeframe-levels">
                            <div class="level-block">
                                <div class="level-label">é˜»åŠ›</div>
                                <div class="level-price resistance" id="tf5minResistance">-</div>
                            </div>
                            <div class="level-block">
                                <div class="level-label">æ”¯æ’‘</div>
                                <div class="level-price support" id="tf5minSupport">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeframe-card">
                        <div class="timeframe-title">15åˆ†é’Ÿ</div>
                        <div class="timeframe-levels">
                            <div class="level-block">
                                <div class="level-label">é˜»åŠ›</div>
                                <div class="level-price resistance" id="tf15minResistance">-</div>
                            </div>
                            <div class="level-block">
                                <div class="level-label">æ”¯æ’‘</div>
                                <div class="level-price support" id="tf15minSupport">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timeframe-card">
                        <div class="timeframe-title">æ—¥çº¿</div>
                        <div class="timeframe-levels">
                            <div class="level-block">
                                <div class="level-label">é˜»åŠ›</div>
                                <div class="level-price resistance" id="tfdailyResistance">-</div>
                            </div>
                            <div class="level-block">
                                <div class="level-label">æ”¯æ’‘</div>
                                <div class="level-price support" id="tfdailySupport">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let klineChart = null;
        let volumeChart = null;
        let currentData = null;
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            klineChart = echarts.init(document.getElementById('klineChart'), 'dark');
            volumeChart = echarts.init(document.getElementById('volumeChart'), 'dark');
            
            // è®¾ç½®loading
            klineChart.showLoading();
            volumeChart.showLoading();
        }
        
        // åŠ è½½å›¾è¡¨æ•°æ®
        async function loadChart() {
            const stockCode = document.getElementById('stockCode').value;
            const period = document.getElementById('period').value;
            const length = parseInt(document.getElementById('length').value);
            const resistanceThreshold = parseInt(document.getElementById('resistanceThreshold').value);
            const supportThreshold = parseInt(document.getElementById('supportThreshold').value);
            
            if (!stockCode) {
                alert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
                return;
            }
            
            try {
                // å¤„ç†æ¸¯è‚¡ä»£ç 
                const formattedCode = stockCode.startsWith('hk') ? stockCode : `hk${stockCode}`;
                
                // è·å–æ”¯æ’‘é˜»åŠ›æ•°æ®
                const response = await fetch(`http://localhost:9000/api/volume-sr/levels/${stockCode}?` + 
                    `period=${period}&length=${length}&resistance_threshold=${resistanceThreshold}&support_threshold=${supportThreshold}`);
                const result = await response.json();
                
                if (result.code !== 200) {
                    throw new Error(result.message || 'è·å–æ•°æ®å¤±è´¥');
                }
                
                currentData = result.data;
                
                // æ›´æ–°å›¾è¡¨æ ‡é¢˜å’Œä¿¡æ¯
                updateChartInfo(currentData);
                
                // è·å–Kçº¿æ•°æ®ç”¨äºç»˜å›¾
                const klineResponse = await fetch(`http://localhost:9000/api/stocks/${formattedCode}/kline?period=${period === 'daily' ? 'daily' : period}&limit=100`);
                const klineResult = await klineResponse.json();
                
                // å¤„ç†ä¸åŒçš„æ•°æ®æ ¼å¼ - ä¼˜å…ˆä½¿ç”¨ klines å­—æ®µ
                let klineData = klineResult.klines || klineResult.data || [];
                
                if (klineData && klineData.length > 0) {
                    console.log('Kçº¿æ•°æ®è·å–æˆåŠŸï¼Œæ•°æ®ç‚¹æ•°:', klineData.length);
                    drawKlineChart(klineData, currentData);
                    drawVolumeChart(klineData, currentData);
                } else {
                    console.error('Kçº¿æ•°æ®ä¸ºç©º:', klineResult);
                    klineChart.hideLoading();
                    volumeChart.hideLoading();
                }
                
                // æ›´æ–°äº¤æ˜“ä¿¡å·
                updateSignals(currentData.signals);
                
            } catch (error) {
                console.error('åŠ è½½å›¾è¡¨å¤±è´¥:', error);
                alert('åŠ è½½å¤±è´¥: ' + error.message);
                klineChart.hideLoading();
                volumeChart.hideLoading();
            }
        }
        
        // æ›´æ–°å›¾è¡¨ä¿¡æ¯
        function updateChartInfo(data) {
            const periodText = {
                '5min': '5åˆ†é’Ÿ',
                '15min': '15åˆ†é’Ÿ',
                'daily': 'æ—¥çº¿'
            };
            
            document.getElementById('chartTitle').textContent = 
                `${data.stock_code} - ${periodText[data.period] || data.period}`;
            
            document.getElementById('resistanceValue').textContent = 
                data.resistance ? data.resistance.price.toFixed(2) : '-';
            
            document.getElementById('supportValue').textContent = 
                data.support ? data.support.price.toFixed(2) : '-';
            
            document.getElementById('currentValue').textContent = 
                data.current_price.toFixed(2);
        }
        
        // ç»˜åˆ¶Kçº¿å›¾
        function drawKlineChart(klineData, srData) {
            const dates = klineData.map(item => item.date || item.time);
            const values = klineData.map(item => [
                item.open,
                item.close,
                item.low,
                item.high,
                item.volume
            ]);
            
            // æ„å»ºæ ‡è®°çº¿å’Œæ ‡è®°åŒºåŸŸ
            const markLineData = [];
            const markAreaData = [];
            
            // æ·»åŠ é˜»åŠ›çº¿å’Œé˜»åŠ›å¸¦
            if (srData.resistance) {
                markLineData.push({
                    name: 'é˜»åŠ›ä½',
                    yAxis: srData.resistance.price,
                    lineStyle: {
                        color: '#f44336',
                        width: 2,
                        type: 'solid'
                    },
                    label: {
                        position: 'end',
                        formatter: 'é˜»åŠ› {c}'
                    }
                });
                
                if (srData.resistance_band) {
                    markAreaData.push([
                        {
                            yAxis: srData.resistance_band.lower,
                            itemStyle: {
                                color: 'rgba(244, 67, 54, 0.1)'
                            }
                        },
                        {
                            yAxis: srData.resistance_band.upper
                        }
                    ]);
                }
            }
            
            // æ·»åŠ æ”¯æ’‘çº¿å’Œæ”¯æ’‘å¸¦
            if (srData.support) {
                markLineData.push({
                    name: 'æ”¯æ’‘ä½',
                    yAxis: srData.support.price,
                    lineStyle: {
                        color: '#4CAF50',
                        width: 2,
                        type: 'solid'
                    },
                    label: {
                        position: 'end',
                        formatter: 'æ”¯æ’‘ {c}'
                    }
                });
                
                if (srData.support_band) {
                    markAreaData.push([
                        {
                            yAxis: srData.support_band.lower,
                            itemStyle: {
                                color: 'rgba(76, 175, 80, 0.1)'
                            }
                        },
                        {
                            yAxis: srData.support_band.upper
                        }
                    ]);
                }
            }
            
            // æ„å»ºKçº¿å›¾é…ç½®
            const option = {
                backgroundColor: '#1a1a1a',
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                grid: {
                    left: '10%',
                    right: '10%',
                    top: '10%',
                    bottom: '10%'
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: '#666' } },
                    axisLabel: { color: '#999' }
                },
                yAxis: {
                    scale: true,
                    axisLine: { lineStyle: { color: '#666' } },
                    axisLabel: { color: '#999' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [{
                    name: 'Kçº¿',
                    type: 'candlestick',
                    data: values,
                    itemStyle: {
                        color: '#f44336',
                        color0: '#4CAF50',
                        borderColor: '#f44336',
                        borderColor0: '#4CAF50'
                    },
                    markLine: {
                        symbol: 'none',
                        data: markLineData
                    },
                    markArea: {
                        data: markAreaData
                    }
                }]
            };
            
            klineChart.hideLoading();
            klineChart.setOption(option);
        }
        
        // ç»˜åˆ¶æˆäº¤é‡å›¾
        function drawVolumeChart(klineData, srData) {
            const dates = klineData.map(item => item.date || item.time);
            const volumes = klineData.map(item => item.volume);
            const colors = klineData.map(item => item.close >= item.open ? '#4CAF50' : '#f44336');
            
            // æ ‡è®°é«˜æˆäº¤é‡Kçº¿
            const highVolumeData = srData.high_volume_bars ? 
                volumes.map((vol, idx) => {
                    return srData.high_volume_bars.includes(idx) ? 
                        { value: vol, itemStyle: { color: '#FFC107' } } : vol;
                }) : volumes;
            
            const option = {
                backgroundColor: '#1a1a1a',
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                grid: {
                    left: '10%',
                    right: '10%',
                    top: '10%',
                    bottom: '10%'
                },
                xAxis: {
                    type: 'category',
                    data: dates,
                    axisLine: { lineStyle: { color: '#666' } },
                    axisLabel: { color: '#999' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#666' } },
                    axisLabel: { color: '#999' },
                    splitLine: { lineStyle: { color: '#333' } }
                },
                series: [{
                    name: 'æˆäº¤é‡',
                    type: 'bar',
                    data: highVolumeData,
                    itemStyle: {
                        color: function(params) {
                            return colors[params.dataIndex];
                        }
                    }
                }]
            };
            
            volumeChart.hideLoading();
            volumeChart.setOption(option);
        }
        
        // æ›´æ–°äº¤æ˜“ä¿¡å·
        function updateSignals(signals) {
            if (!signals) return;
            
            const signalClass = {
                'BUY': 'buy',
                'SELL': 'sell',
                'HOLD': 'hold',
                'NEUTRAL': 'hold'
            };
            
            const signalContent = document.getElementById('signalContent');
            signalContent.innerHTML = `
                <div class="signal-item ${signalClass[signals.signal] || 'hold'}">
                    <div class="signal-label">ä¿¡å·</div>
                    <div class="signal-value">${signals.signal || 'NEUTRAL'}</div>
                </div>
                <div class="signal-item">
                    <div class="signal-label">åŸå› </div>
                    <div class="signal-value">${signals.reason || '-'}</div>
                </div>
                <div class="signal-item">
                    <div class="signal-label">ä½ç½®</div>
                    <div class="signal-value">${((signals.position_in_range || 0) * 100).toFixed(1)}%</div>
                </div>
                <div class="signal-item">
                    <div class="signal-label">è·é˜»åŠ›</div>
                    <div class="signal-value resistance">${(signals.resistance_distance || 0).toFixed(2)}%</div>
                </div>
                <div class="signal-item">
                    <div class="signal-label">è·æ”¯æ’‘</div>
                    <div class="signal-value support">${(signals.support_distance || 0).toFixed(2)}%</div>
                </div>
                ${signals.stop_loss ? `
                <div class="signal-item">
                    <div class="signal-label">æ­¢æŸ</div>
                    <div class="signal-value">${signals.stop_loss.toFixed(2)}</div>
                </div>` : ''}
                ${signals.take_profit ? `
                <div class="signal-item">
                    <div class="signal-label">æ­¢ç›ˆ</div>
                    <div class="signal-value">${signals.take_profit.toFixed(2)}</div>
                </div>` : ''}
            `;
        }
        
        // åŠ è½½å¤šæ—¶é—´å‘¨æœŸ
        async function loadMultiTimeframe() {
            const stockCode = document.getElementById('stockCode').value;
            
            if (!stockCode) {
                alert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ');
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:9000/api/volume-sr/multi-timeframe/${stockCode}`);
                const result = await response.json();
                
                if (result.code === 200) {
                    const timeframes = result.data.timeframes;
                    
                    // æ›´æ–°5åˆ†é’Ÿ
                    if (timeframes['5min'] && !timeframes['5min'].error) {
                        document.getElementById('tf5minResistance').textContent = 
                            timeframes['5min'].resistance ? timeframes['5min'].resistance.price.toFixed(2) : '-';
                        document.getElementById('tf5minSupport').textContent = 
                            timeframes['5min'].support ? timeframes['5min'].support.price.toFixed(2) : '-';
                    }
                    
                    // æ›´æ–°15åˆ†é’Ÿ
                    if (timeframes['15min'] && !timeframes['15min'].error) {
                        document.getElementById('tf15minResistance').textContent = 
                            timeframes['15min'].resistance ? timeframes['15min'].resistance.price.toFixed(2) : '-';
                        document.getElementById('tf15minSupport').textContent = 
                            timeframes['15min'].support ? timeframes['15min'].support.price.toFixed(2) : '-';
                    }
                    
                    // æ›´æ–°æ—¥çº¿
                    if (timeframes['daily'] && !timeframes['daily'].error) {
                        document.getElementById('tfdailyResistance').textContent = 
                            timeframes['daily'].resistance ? timeframes['daily'].resistance.price.toFixed(2) : '-';
                        document.getElementById('tfdailySupport').textContent = 
                            timeframes['daily'].support ? timeframes['daily'].support.price.toFixed(2) : '-';
                    }
                    
                    document.getElementById('multiTimeframe').style.display = 'grid';
                }
            } catch (error) {
                console.error('åŠ è½½å¤šæ—¶é—´å‘¨æœŸå¤±è´¥:', error);
                alert('åŠ è½½å¤±è´¥: ' + error.message);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', () => {
            initCharts();
            loadChart();
        });
        
        // å“åº”çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', () => {
            if (klineChart) klineChart.resize();
            if (volumeChart) volumeChart.resize();
        });
    </script>
</body>
</html>