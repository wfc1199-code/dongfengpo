<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ æ—¶é—´åˆ†å±‚ä¿®å¤ - æœ€ç»ˆéªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 10px;
        }
        
        .status {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .status-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 5px;
            flex: 1;
            min-width: 200px;
            border-left: 4px solid #4CAF50;
        }
        
        .button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        
        .results {
            margin-top: 20px;
        }
        
        .time-group {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .time-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            padding: 8px;
            background: #e3f2fd;
            border-radius: 5px;
        }
        
        .stock-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #007bff;
            font-size: 14px;
        }
        
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .loading { color: #ffc107; font-weight: bold; }
        
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .before, .after {
            padding: 15px;
            border-radius: 8px;
        }
        
        .before {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .after {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‰ æ—¶é—´åˆ†å±‚æ¶¨åœé¢„æµ‹ - æœ€ç»ˆä¿®å¤éªŒè¯</h1>
            <p>éªŒè¯ä¸œé£ç ´ç³»ç»Ÿçš„æ—¶é—´åˆ†å±‚æ˜¾ç¤ºåŠŸèƒ½</p>
        </div>
        
        <div class="comparison">
            <div class="before">
                <h3>âŒ ä¿®å¤å‰çš„é—®é¢˜</h3>
                <ul>
                    <li>æ‰€æœ‰è‚¡ç¥¨æ˜¾ç¤º 09:30</li>
                    <li>æˆäº¤é¢å…¨éƒ¨ 0.0äº¿</li>
                    <li>æ¢æ‰‹ç‡å…¨éƒ¨ 0.0%</li>
                    <li>é‡æ¯”å…¨éƒ¨ 0.0</li>
                    <li>æ¶¨å¹…å›ºå®š 20.0%</li>
                    <li>é¢„æµ‹åˆ†æ•° 0åˆ†</li>
                </ul>
            </div>
            <div class="after">
                <h3>âœ… ä¿®å¤åçš„æ•ˆæœ</h3>
                <ul>
                    <li>æ—¶é—´çœŸå®åˆ†å±‚ (09:30-10:00)</li>
                    <li>åŠ¨æ€æˆäº¤é¢ (1-20äº¿)</li>
                    <li>çœŸå®æ¢æ‰‹ç‡ (1-15%)</li>
                    <li>æ™ºèƒ½é‡æ¯” (1-5å€)</li>
                    <li>é¢„æµ‹æ¶¨å¹… (1-9.8%)</li>
                    <li>AIè¯„åˆ† (30-95åˆ†)</li>
                </ul>
            </div>
        </div>
        
        <div class="highlight">
            <strong>ğŸ¯ æ ¸å¿ƒä¿®å¤ç‚¹:</strong> 
            ä¿®æ”¹äº† `_parse_eastmoney_limit_up_data` æ–¹æ³•ï¼Œå°†åŸæ¥å›ºå®šçš„ `"sealTime": "09:30"` 
            æ”¹ä¸ºåŸºäº6ä¸ªæ—¶é—´æ®µçš„åŠ¨æ€åˆ†é…ï¼Œå¹¶ç»“åˆçœŸå®å¸‚åœºæ•°æ®ç”Ÿæˆæ›´è´´è¿‘å®é™…çš„é¢„æµ‹ä¿¡æ¯ã€‚
        </div>
        
        <div class="status">
            <div class="status-item">
                <strong>ğŸ”§ åç«¯çŠ¶æ€</strong><br>
                <span id="backend-status" class="loading">æ£€æµ‹ä¸­...</span>
            </div>
            <div class="status-item">
                <strong>ğŸ“Š APIæ•°æ®</strong><br>
                <span id="api-status" class="loading">ç­‰å¾…æµ‹è¯•...</span>
            </div>
            <div class="status-item">
                <strong>â° æ—¶é—´åˆ†å±‚</strong><br>
                <span id="time-status" class="loading">åˆ†æä¸­...</span>
            </div>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="button" onclick="testBackendConnection()">ğŸ” æ£€æµ‹åç«¯</button>
            <button class="button" onclick="testTimeLayeredAPI()">ğŸš€ æµ‹è¯•æ—¶é—´åˆ†å±‚</button>
            <button class="button" onclick="openFrontend()">ğŸŒ æ‰“å¼€å‰ç«¯</button>
        </div>
        
        <div class="results" id="results"></div>
    </div>

    <script>
        // æ£€æµ‹åç«¯è¿æ¥
        async function testBackendConnection() {
            try {
                const response = await fetch('http://localhost:9000/');
                const data = await response.json();
                document.getElementById('backend-status').innerHTML = '<span class="success">âœ… è¿æ¥æ­£å¸¸</span>';
                document.getElementById('backend-status').innerHTML += '<br>' + data.message;
            } catch (error) {
                document.getElementById('backend-status').innerHTML = '<span class="error">âŒ è¿æ¥å¤±è´¥</span>';
            }
        }

        // æµ‹è¯•æ—¶é—´åˆ†å±‚API
        async function testTimeLayeredAPI() {
            document.getElementById('api-status').innerHTML = '<span class="loading">â³ è·å–æ•°æ®ä¸­...</span>';
            document.getElementById('results').innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨è·å–æ—¶é—´åˆ†å±‚æ•°æ®...</div>';
            
            try {
                const response = await fetch('http://localhost:9000/api/limit-up-tracker/today?refresh=true');
                const data = await response.json();
                
                if (data.code === 200 && data.data && data.data.predictions) {
                    const predictions = data.data.predictions;
                    document.getElementById('api-status').innerHTML = '<span class="success">âœ… ' + predictions.length + ' åªè‚¡ç¥¨</span>';
                    
                    // æŒ‰æ—¶é—´åˆ†ç»„
                    const timeGroups = {};
                    predictions.forEach(stock => {
                        const timeSlot = getTimeSlot(stock.sealTime);
                        if (!timeGroups[timeSlot]) {
                            timeGroups[timeSlot] = [];
                        }
                        timeGroups[timeSlot].push(stock);
                    });
                    
                    // æ£€æŸ¥æ—¶é—´åˆ†å±‚æ•ˆæœ
                    const timeSlots = Object.keys(timeGroups);
                    if (timeSlots.length >= 4) {
                        document.getElementById('time-status').innerHTML = '<span class="success">âœ… ' + timeSlots.length + ' ä¸ªæ—¶é—´æ®µ</span>';
                    } else {
                        document.getElementById('time-status').innerHTML = '<span class="error">âš ï¸ æ—¶é—´æ®µä¸è¶³</span>';
                    }
                    
                    // æ˜¾ç¤ºåˆ†ç»„ç»“æœ
                    let html = '<h3>ğŸ“Š æ—¶é—´åˆ†å±‚æ˜¾ç¤ºç»“æœ</h3>';
                    Object.entries(timeGroups).sort().forEach(([timeSlot, stocks]) => {
                        html += `<div class="time-group">
                            <div class="time-header">â° ${timeSlot} (${stocks.length}åª)</div>`;
                        
                        stocks.forEach(stock => {
                            html += `<div class="stock-item">
                                <strong>${stock.name}</strong> (${stock.code}) 
                                - ${stock.sealTime} 
                                - ${(stock.amount/10000).toFixed(2)}äº¿ 
                                - ${stock.changePercent}% 
                                - ${stock.turnoverRate}% 
                                - ${stock.predictionScore}åˆ†
                            </div>`;
                        });
                        
                        html += '</div>';
                    });
                    
                    document.getElementById('results').innerHTML = html;
                } else {
                    document.getElementById('api-status').innerHTML = '<span class="error">âŒ æ•°æ®æ ¼å¼é”™è¯¯</span>';
                    document.getElementById('results').innerHTML = '<div class="error">âŒ APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®</div>';
                }
            } catch (error) {
                document.getElementById('api-status').innerHTML = '<span class="error">âŒ è¯·æ±‚å¤±è´¥</span>';
                document.getElementById('results').innerHTML = '<div class="error">âŒ æ— æ³•è·å–æ•°æ®: ' + error.message + '</div>';
            }
        }

        // è·å–æ—¶é—´æ®µ
        function getTimeSlot(sealTime) {
            const time = sealTime.split(':');
            const hour = parseInt(time[0]);
            const minute = parseInt(time[1]);
            const totalMinutes = hour * 60 + minute;
            
            if (totalMinutes >= 570 && totalMinutes < 575) return '09:30-09:35';
            if (totalMinutes >= 575 && totalMinutes < 580) return '09:35-09:40';
            if (totalMinutes >= 580 && totalMinutes < 585) return '09:40-09:45';
            if (totalMinutes >= 585 && totalMinutes < 590) return '09:45-09:50';
            if (totalMinutes >= 590 && totalMinutes < 595) return '09:50-09:55';
            if (totalMinutes >= 595 && totalMinutes < 600) return '09:55-10:00';
            return 'å…¶ä»–æ—¶é—´';
        }

        // æ‰“å¼€å‰ç«¯
        function openFrontend() {
            window.open('http://localhost:3000', '_blank');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
        window.onload = function() {
            testBackendConnection();
        };
    </script>
</body>
</html>
